<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>American English Vocabulary</title>

<style>
/* ===== –¢–ï–ú–ê ===== */
:root {
  --bg: #fff1f6;
  --card: #ffffff;
  --panel: #ffffff;
  --text: #3b1f2b;
  --muted: #8b6f7a;
  --accent: #db2777;
  --green: #9d174d;
  --border: #f2d5e3;
  --shadow: 0 4px 12px rgba(219,39,119,.08);
}
[data-theme="dark"] {
  --bg: #160a10;
  --card: #1f0b15;
  --panel: #190910;
  --text: #f8e6ee;
  --muted: #c9a4b2;
  --accent: #fb7185;
  --green: #f472b6;
  --border: #3b1423;
  --shadow: 0 4px 12px rgba(0,0,0,.25);
}
* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, system-ui, sans-serif;
  margin: 0;
  padding: 40px 20px 60px;
  background: var(--bg);
  color: var(--text);
  text-align: center;
}

/* ===== UI ===== */
h1 { margin-bottom: 20px; }

.stats-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
  max-width: 680px;
  margin: 0 auto 20px;
}

.stats {
  font-size: 14px;
  color: var(--muted);
  padding: 6px 12px;
  background: var(--panel);
  border-radius: 8px;
  border: 1px solid var(--border);
}

#searchInput {
  width: 100%;
  padding: 10px 14px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
}

.control-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-bottom: 16px;
}

.test-toggle, .ipa-toggle {
  padding: 8px 14px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
  cursor: pointer;
}

.top-bar {
  max-width: 720px;
  margin: 0 auto 24px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
}

.controls {
  display: flex;
  gap: 16px;
  justify-content: center;
}

.control-item {
  font-size: 13px;
}

#voiceSelect, #voiceSelectSide {
  min-width: 240px;
}

.theme-toggle, .settings-toggle {
  position: fixed;
  top: 18px;
  right: 18px;
  padding: 8px 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
}
.settings-toggle { top: 60px; }

.side-panel {
  position: fixed;
  top: 102px;
  right: 18px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  display: none;
  flex-direction: column;
  gap: 14px;
}

/* ===== –ö–ê–†–¢–û–ß–ö–ò ===== */
#container { max-width: 680px; margin: 0 auto; }

.card {
  background: var(--card);
  padding: 24px 28px;
  border-radius: 14px;
  border: 1px solid var(--border);
  margin-bottom: 20px;
  text-align: left;
  position: relative;
}

.word-line { font-size: 21px; margin: 28px 0 14px; }
.word-en { color: var(--accent); font-weight: 700; cursor: pointer; }
.word-ru { cursor: pointer; }

.en { color: var(--green); font-weight: 600; cursor: pointer; }
.ru { color: var(--muted); cursor: pointer; margin-bottom: 12px; }
.ipa { font-style: italic; font-size: 13px; color: var(--accent); }

.hide-ru .ru { display: none; }
.hide-ipa .ipa { display: none; }

/* ===== –ü–ê–ì–ò–ù–ê–¶–ò–Ø ===== */
.pagination { display: flex; gap: 8px; justify-content: center; }
.page-btn { padding: 6px 10px; border-radius: 8px; }
.page-btn.active { background: var(--accent); color: white; }
</style>
</head>

<body>

<button class="theme-toggle" onclick="toggleTheme()">üåô</button>
<button class="settings-toggle" onclick="toggleSettings()">üéôÔ∏è</button>

<h1>üá∫üá∏ American English Vocabulary</h1>

<div class="stats-bar">
  <div class="stats" id="totalStats"></div>
  <input id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫">
</div>

<div class="control-buttons">
  <button class="test-toggle" onclick="toggleTestMode()">üß† –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞</button>
  <button class="ipa-toggle" onclick="toggleIpaMode()">üëÅÔ∏è IPA</button>
</div>

<div class="top-bar">
  <div>
    <label>üéôÔ∏è –ì–æ–ª–æ—Å:</label><br>
    <select id="voiceSelect"></select>
  </div>
  <div class="controls">
    <div class="control-item">
      <label>–°–∫–æ—Ä–æ—Å—Ç—å</label><br>
      <input id="rateSlider" type="range" min="0.3" max="1.2" step="0.05">
    </div>
    <div class="control-item">
      <label>Pitch</label><br>
      <input id="pitchSlider" type="range" min="0.7" max="1.3" step="0.05">
    </div>
  </div>
</div>

<div id="container"></div>
<div class="pagination" id="pagination"></div>

<script>
/* ================== ANDROID ================== */
const IS_ANDROID = /Android/i.test(navigator.userAgent);

/* ================== STATE ================== */
const PAGE_SIZE = 100;
let allData = [];
let filteredData = [];
let currentPage = 1;
let testMode = false;
let showIpa = false;

/* ================== TTS ================== */
const rateSlider = document.getElementById("rateSlider");
const pitchSlider = document.getElementById("pitchSlider");
rateSlider.value = localStorage.getItem("tts_rate") || 0.9;
pitchSlider.value = localStorage.getItem("tts_pitch") || 1.02;

rateSlider.oninput = () => localStorage.setItem("tts_rate", rateSlider.value);
pitchSlider.oninput = () => localStorage.setItem("tts_pitch", pitchSlider.value);

function speakText(text){
  const synth = speechSynthesis;
  synth.cancel();

  if (IS_ANDROID) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = rateSlider.value;
    u.pitch = pitchSlider.value;
    synth.speak(u);
    return;
  }

  if (voiceSelect.value === "mute") return;
  const voice = speechSynthesis.getVoices()[voiceSelect.value];
  const u = new SpeechSynthesisUtterance(text);
  u.voice = voice;
  u.lang = "en-US";
  u.rate = rateSlider.value;
  u.pitch = pitchSlider.value;
  synth.speak(u);
}

/* ================== VOICES (DESKTOP ONLY) ================== */
const voiceSelect = document.getElementById("voiceSelect");
function populateVoices(){
  if (IS_ANDROID) return;
  const voices = speechSynthesis.getVoices();
  voiceSelect.innerHTML = "";
  voices.forEach((v,i)=>{
    if(v.lang==="en-US"){
      const o=document.createElement("option");
      o.value=i; o.textContent=v.name;
      voiceSelect.appendChild(o);
    }
  });
  const mute=document.createElement("option");
  mute.value="mute"; mute.textContent="üîá –ë–µ–∑ –æ–∑–≤—É—á–∫–∏";
  voiceSelect.appendChild(mute);
}
speechSynthesis.onvoiceschanged = populateVoices;

/* ================== UI ================== */
function toggleTheme(){
  const t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";
  document.documentElement.setAttribute("data-theme",t);
  localStorage.setItem("theme",t);
}
function toggleTestMode(){
  testMode=!testMode;
  document.body.classList.toggle("hide-ru",testMode);
}
function toggleIpaMode(){
  showIpa=!showIpa;
  document.body.classList.toggle("hide-ipa",!showIpa);
}
function toggleSettings(){}

/* ================== RENDER ================== */
function render(){
  const c=document.getElementById("container");
  c.innerHTML="";
  filteredData.slice(0,PAGE_SIZE).forEach(item=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <div class="word-line">
        <span class="word-en">${item.word}</span> ‚Äì
        <span class="word-ru">${item.translation}</span>
      </div>
      ${item.examples.map(e=>`
        <div class="en">${e.en}</div>
        <div class="ipa">/${e.ipa}/</div>
        <div class="ru">${e.ru}</div>
      `).join("")}
    `;
    d.querySelectorAll(".word-en,.en").forEach(el=>{
      el.onclick=()=>speakText(el.textContent);
    });
    c.appendChild(d);
  });
}

/* ================== DATA ================== */
fetch("data.json").then(r=>r.json()).then(d=>{
  allData=d;
  filteredData=[...d];
  render();
});

/* ================== ANDROID UI FIX ================== */
if (IS_ANDROID) {
  document.getElementById("voiceSelect").closest("div").style.display="none";
}
</script>

</body>
</html>
