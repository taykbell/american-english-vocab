<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>American English Vocabulary</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg: #fff1f6;
  --card: #ffffff;
  --panel: #ffffff;
  --text: #3b1f2b;
  --muted: #8b6f7a;
  --accent: #db2777;
  --green: #9d174d;
  --border: #f2d5e3;
  --shadow: 0 4px 12px rgba(219,39,119,.08);
  --example-bg: rgba(251, 113, 133, 0.05);
}

[data-theme="dark"] {
  --bg: #160a10;
  --card: #1f0b15;
  --panel: #190910;
  --text: #f8e6ee;
  --muted: #c9a4b2;
  --accent: #fb7185;
  --green: #f472b6;
  --border: #3b1423;
  --shadow: 0 4px 12px rgba(0,0,0,.25);
  --example-bg: rgba(251, 113, 133, 0.08);
}

* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, system-ui, sans-serif;
  margin: 0;
  padding: 40px 20px 60px;
  background: var(--bg);
  color: var(--text);
  transition: background .3s, color .3s;
  text-align: center;
}

h1 { margin: 0 0 8px; font-weight: 700; font-size: 2rem; }

.header-subtitle {
  color: var(--muted);
  font-size: 0.95rem;
  margin-bottom: 20px;
}

/* ===== –°–ï–ö–¶–ò–Ø –ü–û–ò–°–ö–ê ===== */
.search-section {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
  max-width: 720px;
  margin-left: auto;
  margin-right: auto;
}

.search-section .stats {
  font-size: 14px;
  color: var(--muted);
  padding: 6px 12px;
  background: var(--panel);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.search-container {
  flex: 1;
  max-width: 400px;
  min-width: 250px;
}

#searchInput {
  width: 100%;
  padding: 10px 15px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
  font-size: 14px;
  transition: all 0.3s;
}

#searchInput:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(219,39,119,0.1);
}

/* ===== –°–ï–ö–¶–ò–Ø –ë–´–°–¢–†–û–ì–û –ü–ï–†–ï–•–û–î–ê ===== */
.card-jump-section {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto 20px;
  max-width: 720px;
}

.card-jump-container {
  display: flex;
  align-items: center;
  gap: 0;
  width: 100%;
  max-width: 400px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 4px;
  box-shadow: var(--shadow);
  transition: all 0.3s ease;
}

.card-jump-container:hover {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(219, 39, 119, 0.1);
}

.card-jump-icon {
  padding: 0 12px;
  color: var(--muted);
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card-jump-input {
  flex: 1;
  padding: 10px 12px;
  border: none;
  border-radius: 8px;
  background: transparent;
  color: var(--text);
  font-size: 14px;
  outline: none;
  transition: all 0.2s;
}

.card-jump-input:focus {
  background: rgba(219, 39, 119, 0.05);
}

.card-jump-btn {
  padding: 10px 16px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  color: white;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.card-jump-btn:hover {
  background: var(--green);
  transform: translateY(-1px);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
@keyframes fadeInOut {
  0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
  10% { opacity: 1; transform: translateX(-50%) translateY(0); }
  90% { opacity: 1; transform: translateX(-50%) translateY(0); }
  100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
}

/* ===== –°–ï–ö–¶–ò–Ø –§–ò–õ–¨–¢–†–û–í ===== */
.filter-section {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  margin: 0 auto 20px;
  max-width: 720px;
  box-shadow: var(--shadow);
}

.filter-section h3 {
  margin: 0 0 12px;
  font-size: 16px;
  color: var(--accent);
  text-align: left;
  padding-left: 8px;
}

.filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: space-between;
  align-items: flex-start;
}

.filter-container {
  flex: 1;
  min-width: 200px;
}

.filter-container label {
  display: block;
  margin-bottom: 6px;
  font-size: 13px;
  color: var(--muted);
  font-weight: 500;
  text-align: left;
}

#tagFilter, #themeFilter {
  width: 100%;
  padding: 10px 15px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
}

#tagFilter:hover, #themeFilter:hover {
  border-color: var(--accent);
}

#tagFilter:focus, #themeFilter:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(219,39,119,0.1);
}

#tagFilter[multiple] {
  height: auto;
  min-height: 44px;
  max-height: 200px;
  overflow-y: auto;
}

#tagFilter option {
  padding: 8px 12px;
  cursor: pointer;
}

#tagFilter option:hover {
  background-color: var(--accent);
  color: white;
}

.selected-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
}

.tag-badge {
  background: var(--accent);
  color: white;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: all 0.2s;
}

.tag-badge:hover {
  background: var(--green);
  transform: translateY(-1px);
}

.tag-count {
  font-size: 10px;
  opacity: 0.9;
  background: rgba(255, 255, 255, 0.2);
  padding: 1px 4px;
  border-radius: 8px;
  margin-left: 4px;
}

.remove-tag {
  font-size: 14px;
  line-height: 1;
  margin-left: 3px;
}

.filter-stats {
  font-size: 11px;
  color: var(--muted);
  margin-top: 4px;
  text-align: left;
}

.clear-filters {
  padding: 8px 14px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
  white-space: nowrap;
  margin-top: 12px;
}

.clear-filters:hover {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}

/* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
.word-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 15px;
  margin-top: 10px;
}

.word-tag {
  background: rgba(219, 39, 119, 0.1);
  color: var(--accent);
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 11px;
  border: 1px solid rgba(219, 39, 119, 0.2);
  cursor: pointer;
  transition: all 0.2s;
}

.word-tag:hover {
  background: rgba(219, 39, 119, 0.2);
  transform: translateY(-1px);
}

/* ===== –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ===== */
.control-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin: 0 auto 20px;
  max-width: 720px;
  flex-wrap: wrap;
}

.test-toggle, .ipa-toggle, .syllables-toggle {
  padding: 10px 18px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
  box-shadow: var(--shadow);
}

.test-toggle:hover, .ipa-toggle:hover, .syllables-toggle:hover {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
  transform: translateY(-1px);
}

/* ===== –°–ï–ö–¶–ò–Ø –ù–ê–°–¢–†–û–ô–ö–ò –û–ó–í–£–ß–ö–ò ===== */
.voice-section {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  margin: 0 auto 20px;
  max-width: 720px;
  box-shadow: var(--shadow);
}

.voice-section h3 {
  margin: 0 0 12px;
  font-size: 16px;
  color: var(--accent);
  text-align: left;
  padding-left: 8px;
}

.voice-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  align-items: center;
}

.voice-row {
  display: flex;
  align-items: center;
  gap: 15px;
  width: 100%;
}

.voice-item {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-width: 120px;
}

.voice-item label {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 6px;
  font-weight: 500;
}

#voiceSelect {
  width: 100%;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  font-size: 14px;
  margin-bottom: 8px;
}

.slider-container {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

.slider-with-value {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

.slider-value {
  min-width: 40px;
  font-size: 13px;
  text-align: right;
  color: var(--text);
  font-weight: 500;
}

input[type="range"] {
  accent-color: var(--accent);
  width: 100%;
  flex: 1;
}

/* ===== –ö–ù–û–ü–ö–ò –°–ü–†–ê–í–ê ===== */
.theme-toggle, .settings-toggle {
  position: fixed;
  top: 18px;
  right: 18px;
  padding: 8px 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  cursor: pointer;
  background: var(--panel);
  color: var(--text);
  box-shadow: 0 2px 8px rgba(219,39,119,.12);
  z-index: 100;
}

.settings-toggle {
  top: 60px;
}

/* ===== –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ ===== */
.side-panel {
  position: fixed;
  top: 102px;
  right: 18px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  box-shadow: var(--shadow);
  display: none;
  z-index: 99;
  width: 320px;
  flex-direction: column;
  gap: 18px;
  opacity: 0;
  transform: translateX(20px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.side-panel.open {
  opacity: 1;
  transform: translateX(0);
}

.side-panel > div {
  width: 100%;
}

.side-panel label {
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
  color: var(--muted);
  font-weight: 500;
  text-align: left;
}

.side-panel select {
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
  margin-bottom: 8px;
}

.side-panel select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(219,39,119,0.1);
}

/* –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –≤–Ω—É—Ç—Ä–∏ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
.side-panel .voice-controls {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
}

.side-panel .voice-row {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
}

.side-panel .voice-item {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
}

.side-panel .slider-container {
  display: flex;
  flex-direction: column;
  gap: 8px;
  width: 100%;
}

.side-panel .slider-with-value {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
}

.side-panel .slider-value {
  min-width: 40px;
  font-size: 14px;
  text-align: right;
  color: var(--text);
  font-weight: 500;
}

.side-panel input[type="range"] {
  accent-color: var(--accent);
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: var(--border);
  outline: none;
}

.side-panel input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid var(--card);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* –ö–Ω–æ–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
.side-panel .control-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: 100%;
  margin: 5px 0 0 0;
}

.side-panel .test-toggle,
.side-panel .ipa-toggle,
.side-panel .syllables-toggle {
  padding: 10px 16px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
  text-align: center;
  width: 100%;
}

.side-panel .test-toggle:hover,
.side-panel .ipa-toggle:hover,
.side-panel .syllables-toggle:hover {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
  transform: translateY(-1px);
}

/* ===== –°–ª–æ–≥–æ–≤–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ ===== */
.syllables {
  font-size: 18px;
  margin: 8px 0;
  color: var(--accent);
  font-weight: 600;
  text-align: left;
}

.syllable {
  display: inline-block;
  margin: 0 2px;
}

.syllable.stressed {
  text-decoration: underline;
  font-weight: 700;
}

.example-syllables {
  font-size: 16px;
  margin: 4px 0 8px 0;
  color: var(--accent);
  font-weight: 600;
  text-align: left;
}

/* ===== –ö–ê–†–¢–û–ß–ö–ê ===== */
#container {
  max-width: 720px;
  margin: 0 auto;
}

.card {
  background: var(--card);
  padding: 24px 28px;
  border-radius: 14px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  margin: 0 auto 20px auto;
  text-align: left;
  position: relative;
  transition: all 0.3s ease;
}

/* ===== –ù–û–ú–ï–† + –ò–ö–û–ù–ö–ò –°–ï–†–í–ò–°–û–í ===== */
.card-index {
  position: absolute;
  top: 12px;
  right: 14px;
  font-size: 12px;
  line-height: 1.3;
  padding-bottom: 8px;
}

.card-index a {
  text-decoration: none;
  margin-right: 4px;
  transition: all 0.2s;
  display: inline-block;
  vertical-align: middle;
}

.service-icon {
  width: 20px;
  height: 20px;
  object-fit: contain;
  filter: grayscale(50%);
  opacity: 0.5;
  transition: all 0.2s;
  border-radius: 3px;
  background: var(--bg);
  padding: 2px;
  border: 1px solid var(--border);
}

.service-icon:hover {
  filter: grayscale(0%);
  opacity: 1;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.index-num {
  color: var(--text);
  opacity: 0.15;
  margin-left: 8px;
  font-size: 12px;
  vertical-align: middle;
}

/* ===== –ê–ù–ì–õ–ò–ô–°–ö–û–ï –°–õ–û–í–û –ò –ü–ï–†–ï–í–û–î ===== */
.word-line {
  font-size: 21px;
  margin-bottom: 20px;
  padding-bottom: 12px;
  text-align: left;
}

.word-en {
  color: var(--accent);
  cursor: pointer;
  font-weight: 700;
  display: block;
}

.word-ru {
  cursor: pointer;
  display: block;
  margin-top: 12px;
}

/* ===== –ü–†–ò–ú–ï–†–´ –° –§–û–ù–û–í–´–ú–ò –ë–õ–û–ö–ê–ú–ò ===== */
.example {
  margin-bottom: 14px;
  background: var(--example-bg);
  border-radius: 10px;
  padding: 14px 16px;
  border: 1px solid var(--border);
}

.en {
  cursor: pointer;
  color: var(--green);
  font-weight: 600;
  margin-bottom: 8px;
  line-height: 1.4;
  font-size: 16px;
}

.ipa {
  font-family: "Lucida Sans Unicode", "Arial Unicode MS", sans-serif;
  color: var(--accent);
  font-size: 18px;
  margin-bottom: 8px;
  padding-left: 8px;
  border-left: 2px solid var(--accent);
  font-style: italic;
  opacity: 0.9;
  line-height: 1.3;
  text-align: left;
}

.ru {
  cursor: pointer;
  color: var(--muted);
  margin-bottom: 0;
  line-height: 1.4;
}

.hide-ru .ru {
  display: none;
}

.hide-ipa .ipa {
  display: none;
}

/* ===== –ü–ê–ì–ò–ù–ê–¶–ò–Ø –ò –°–ß–Å–¢–ß–ò–ö –°–õ–û–í ===== */
.pagination-container {
  margin-top: 30px;
}

.pagination {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.page-btn {
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--panel);
  color: var(--text);
  cursor: pointer;
  font-size: 14px;
  min-width: 40px;
}

.page-btn.active {
  background: var(--accent);
  color: white;
}

.word-count {
  font-size: 14px;
  color: var(--muted);
  text-align: center;
}

/* ===== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ===== */
@media (max-width: 768px) {
  body {
    padding: 20px 10px 40px;
  }

  h1 {
    font-size: 1.5rem;
    margin: 0 0 8px;
    padding-top: 40px;
  }

  .header-subtitle {
    font-size: 0.85rem;
    margin-bottom: 15px;
  }

  .theme-toggle, .settings-toggle {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 6px 10px;
    font-size: 12px;
  }

  .settings-toggle {
    top: 50px;
  }

  .search-section {
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
  }

  .search-section .stats {
    width: 100%;
    text-align: center;
    font-size: 12px;
    padding: 5px 10px;
  }

  .search-container {
    width: 100%;
    max-width: 100%;
  }

  .filter-bar {
    flex-direction: column;
    gap: 10px;
    margin: 15px auto 10px;
  }

  .filter-container {
    width: 100%;
    max-width: 100%;
  }

  #tagFilter, #themeFilter {
    font-size: 13px;
    padding: 8px 12px;
  }

  .clear-filters {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
  }

  .filter-container label {
    text-align: center;
  }

  .filter-stats {
    text-align: center;
  }

  .voice-row {
    flex-direction: column;
    gap: 10px;
  }

  .voice-item {
    width: 100%;
    max-width: 100%;
  }

  /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê */
  .card {
    padding: 16px;
    margin-bottom: 15px;
    border-radius: 12px;
  }

  .word-line {
    font-size: 18px;
    margin-top: 20px;
    margin-bottom: 16px;
    padding-bottom: 10px;
    text-align: center;
  }

  .syllables, .ipa {
    text-align: center;
  }

  .word-tags {
    justify-content: center;
    margin-bottom: 10px;
    margin-top: 10px;
  }

  .example {
    margin-bottom: 12px;
    padding: 12px 14px;
    border-radius: 8px;
  }

  .en {
    font-size: 15px;
    margin-bottom: 6px;
  }

  .ipa {
    font-size: 16px;
    margin-bottom: 6px;
  }

  .ru {
    font-size: 13px;
  }

  /* –ò–ö–û–ù–ö–ò –°–ï–†–í–ò–°–û–í –ù–ê –ú–û–ë–ò–õ–¨–ù–û–ú */
  .card-index {
    position: relative;
    top: 0;
    right: 0;
    text-align: center;
    margin-bottom: 10px;
    padding-bottom: 0;
  }

  .card-index a {
    margin: 0 3px;
  }

  .service-icon {
    width: 18px;
    height: 18px;
    padding: 1px;
  }

  .index-num {
    display: block;
    margin-top: 5px;
    margin-left: 0;
    font-size: 11px;
  }

  /* –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ –ù–ê –ú–û–ë–ò–õ–¨–ù–û–ú */
  .side-panel {
    top: 70px;
    right: 10px;
    width: calc(100vw - 20px);
    max-width: 300px;
    padding: 16px;
    gap: 14px;
  }

  .side-panel .voice-controls {
    gap: 12px;
  }

  .side-panel .voice-row {
    gap: 12px;
  }

  .side-panel .slider-with-value {
    gap: 8px;
  }

  .side-panel .slider-value {
    font-size: 13px;
    min-width: 35px;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.3rem;
    padding-top: 50px;
  }

  .theme-toggle, .settings-toggle {
    top: 5px;
    right: 5px;
  }

  .settings-toggle {
    top: 45px;
  }

  .card {
    padding: 12px;
  }

  .word-line {
    font-size: 16px;
  }

  .example {
    margin-bottom: 10px;
    padding: 10px 12px;
  }

  .en {
    font-size: 14px;
  }

  .ipa {
    font-size: 14px;
    margin-bottom: 6px;
  }

  .ru {
    font-size: 12px;
  }

  .control-buttons {
    flex-direction: column;
  }

  .test-toggle, .ipa-toggle, .syllables-toggle {
    width: 100%;
    margin-bottom: 5px;
  }

  .pagination {
    gap: 3px;
  }

  .page-btn {
    padding: 5px 6px;
    font-size: 12px;
    min-width: 32px;
  }

  /* –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ –ù–ê –û–ß–ï–ù–¨ –ú–ê–õ–ï–ù–¨–ö–ò–• –≠–ö–†–ê–ù–ê–• */
  .side-panel {
    padding: 14px;
    gap: 12px;
    max-width: 280px;
  }

  .side-panel label {
    font-size: 13px;
  }

  .side-panel select {
    padding: 8px 10px;
    font-size: 13px;
  }

  .side-panel .test-toggle,
  .side-panel .ipa-toggle,
  .side-panel .syllables-toggle {
    padding: 8px 12px;
    font-size: 13px;
  }
}

/* –î–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
@media (min-width: 769px) and (max-width: 1024px) {
  .voice-section, .filter-section {
    max-width: 90%;
  }

  #container {
    max-width: 90%;
  }

  .card {
    padding: 20px;
  }
}
</style>
</head>

<body>

<button class="theme-toggle" id="themeBtn" onclick="toggleTheme()">üåô</button>
<button class="settings-toggle" id="settingsBtn" onclick="toggleSettings()">üéôÔ∏è</button>
<h1>üá∫üá∏ American English Vocabulary</h1>
<div class="header-subtitle">–ò–∑—É—á–µ–Ω–∏–µ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–≥–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –ø–æ —Å–ª–æ–≤–∞–º –∏ —Ñ—Ä–∞–∑–∞–º</div>

<!-- ===== –°–ï–ö–¶–ò–Ø –ë–´–°–¢–†–û–ì–û –ü–ï–†–ï–•–û–î–ê ===== -->
<div class="card-jump-section">
  <div class="card-jump-container">
    <span class="card-jump-icon">üîç</span>
    <input
      type="number"
      id="cardJumpInput"
      class="card-jump-input"
      placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ (1-30000)..."
      min="1"
      max="30000"
      title="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–π—Ç–∏"
    >
    <button
      class="card-jump-btn"
      onclick="jumpToCard()"
      title="–ü–µ—Ä–µ–π—Ç–∏ –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ"
    >
      ‚û°Ô∏è –ü–µ—Ä–µ–π—Ç–∏
    </button>
  </div>
</div>

<!-- ===== –°–ï–ö–¶–ò–Ø –ü–û–ò–°–ö–ê ===== -->
<div class="search-section">
  <div class="search-container">
    <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞ –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–∞...">
  </div>
  <div class="stats" id="totalStats">–í—Å–µ–≥–æ —Å–ª–æ–≤: 0</div>
</div>

<!-- ===== –°–ï–ö–¶–ò–Ø –§–ò–õ–¨–¢–†–û–í ===== -->
<div class="filter-section">
  <h3>üîç –§–∏–ª—å—Ç—Ä—ã</h3>
  <div class="filter-bar">
    <div class="filter-container">
      <label>–¢–µ–≥–∏</label>
      <select id="tagFilter" multiple size="1">
        <option value="">–í—Å–µ —Ç–µ–≥–∏</option>
      </select>
      <div class="filter-stats" id="tagStats">
        –í—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–æ–≤: 0
      </div>
      <div class="selected-tags" id="selectedTags"></div>
    </div>

    <div class="filter-container">
      <label>–¢–µ–º—ã</label>
      <select id="themeFilter">
        <option value="">–í—Å–µ —Ç–µ–º—ã</option>
      </select>
      <div class="filter-stats" id="themeStats">
        –í—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–º: 0
      </div>
    </div>

    <button class="clear-filters" id="clearFilters" onclick="clearAllFilters()">
      ‚úï –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
    </button>
  </div>
</div>

<!-- ===== –°–ï–ö–¶–ò–Ø –ù–ê–°–¢–†–û–ô–ö–ò –û–ó–í–£–ß–ö–ò ===== -->
<div class="voice-section">
  <h3>üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∑–≤—É—á–∫–∏</h3>
  <div class="voice-controls">
    <div class="voice-row">
      <div class="voice-item">
        <label>–ì–æ–ª–æ—Å:</label>
        <select id="voiceSelect"></select>
      </div>
      <div class="voice-item">
        <div class="slider-container">
          <label>–°–∫–æ—Ä–æ—Å—Ç—å:</label>
          <div class="slider-with-value">
            <input id="rateSlider" type="range" min="0.30" max="1.2" step="0.05">
            <span class="slider-value" id="rateLabel"></span>
          </div>
        </div>
      </div>
      <div class="voice-item">
        <div class="slider-container">
          <label>–í—ã—Å–æ—Ç–∞ –≥–æ–ª–æ—Å–∞:</label>
          <div class="slider-with-value">
            <input id="pitchSlider" type="range" min="0.7" max="1.3" step="0.05">
            <span class="slider-value" id="pitchLabel"></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ===== -->
<div class="control-buttons">
  <button class="test-toggle" id="testBtn" onclick="toggleTestMode()">
    üß† –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞
  </button>
  <button class="ipa-toggle" id="ipaBtn" onclick="toggleIpaMode()">
    üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å IPA
  </button>
  <button class="syllables-toggle" id="syllablesBtn" onclick="toggleSyllablesMode()">
    üî§ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≥–∏
  </button>
</div>

<!-- ===== –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ ===== -->
<div class="side-panel" id="sidePanel">
  <div>
    <label>–ì–æ–ª–æ—Å:</label>
    <select id="voiceSelectSide"></select>
  </div>

  <div class="voice-controls">
    <div class="voice-row">
      <div class="voice-item">
        <div class="slider-container">
          <label>–°–∫–æ—Ä–æ—Å—Ç—å:</label>
          <div class="slider-with-value">
            <input id="rateSliderSide" type="range" min="0.30" max="1.2" step="0.05">
            <span class="slider-value" id="rateLabelSide"></span>
          </div>
        </div>
      </div>
      <div class="voice-item">
        <div class="slider-container">
          <label>–í—ã—Å–æ—Ç–∞ –≥–æ–ª–æ—Å–∞:</label>
          <div class="slider-with-value">
            <input id="pitchSliderSide" type="range" min="0.7" max="1.3" step="0.05">
            <span class="slider-value" id="pitchLabelSide"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="control-buttons">
    <button class="test-toggle" id="testBtnSide" onclick="toggleTestMode()">
      üß† –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞
    </button>
    <button class="ipa-toggle" id="ipaBtnSide" onclick="toggleIpaMode()">
      üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å IPA
    </button>
    <button class="syllables-toggle" id="syllablesBtnSide" onclick="toggleSyllablesMode()">
      üî§ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≥–∏
    </button>
  </div>
</div>

<div id="container"></div>

<div class="pagination-container">
  <div class="pagination" id="pagination"></div>
  <div class="word-count" id="wordCount"></div>
</div>

<script>
const PAGE_SIZE = 100;
let allData = [];
let filteredData = [];
let currentPage = 1;
let currentSearch = '';
let showIpa = false;
let showSyllables = false;
let isAndroid = false;
let isMobileView = false;
let currentTags = [];
let currentTheme = '';
let allTags = new Set();
let allThemes = new Set();
let tagCounts = {};
let themeCounts = {};

function detectPlatform() {
  const userAgent = navigator.userAgent.toLowerCase();
  isAndroid = /android/.test(userAgent);
  isMobileView = window.innerWidth <= 768;
}

window.addEventListener('resize', handleResize);

function handleResize() {
  const wasMobile = isMobileView;
  isMobileView = window.innerWidth <= 768;

  if (wasMobile !== isMobileView) {
    renderPage(currentPage);
  }
}

function updateStats() {
  const total = allData.length;
  const filtered = filteredData.length;
  const start = (currentPage - 1) * PAGE_SIZE + 1;
  const end = Math.min(start + PAGE_SIZE - 1, filtered);

  document.getElementById('totalStats').textContent =
    `–í—Å–µ–≥–æ —Å–ª–æ–≤: ${total} (–Ω–∞–π–¥–µ–Ω–æ: ${filtered})`;

  document.getElementById('wordCount').textContent =
    filtered > 0 ? `–ü–æ–∫–∞–∑–∞–Ω—ã —Å–ª–æ–≤–∞ ${start}-${end} –∏–∑ ${filtered}` : '–°–ª–æ–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
}

function extractTagsAndThemes() {
  allTags.clear();
  allThemes.clear();
  tagCounts = {};
  themeCounts = {};

  allData.forEach(item => {
    if (item.tags) {
      item.tags.forEach(tag => {
        allTags.add(tag);
        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
      });
    }

    if (item.theme) {
      allThemes.add(item.theme);
      themeCounts[item.theme] = (themeCounts[item.theme] || 0) + 1;
    }
  });

  document.getElementById('tagStats').textContent =
    `–í—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–æ–≤: ${allTags.size}`;
  document.getElementById('themeStats').textContent =
    `–í—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–º: ${allThemes.size}`;

  populateFilterDropdowns();
}

function populateFilterDropdowns() {
  const tagFilter = document.getElementById('tagFilter');
  const themeFilter = document.getElementById('themeFilter');

  const sortedTags = Array.from(allTags).sort();
  tagFilter.innerHTML = '<option value="">–í—Å–µ —Ç–µ–≥–∏</option>';

  sortedTags.forEach(tag => {
    const option = document.createElement('option');
    option.value = tag;
    const count = tagCounts[tag] || 0;
    option.textContent = `${tag} (${count})`;
    option.title = `${tag} ‚Äî ${count} —Å–ª–æ–≤`;
    tagFilter.appendChild(option);
  });

  tagFilter.setAttribute('multiple', 'multiple');

  const sortedThemes = Array.from(allThemes).sort();
  themeFilter.innerHTML = '<option value="">–í—Å–µ —Ç–µ–º—ã</option>';

  sortedThemes.forEach(theme => {
    const option = document.createElement('option');
    option.value = theme;
    const count = themeCounts[theme] || 0;
    const displayName = theme.length > 35 ? theme.substring(0, 35) + '...' : theme;
    option.textContent = `${displayName} (${count})`;
    option.title = `${theme} ‚Äî ${count} —Å–ª–æ–≤`;
    themeFilter.appendChild(option);
  });
}

function updateSelectedTagsDisplay() {
  const container = document.getElementById('selectedTags');
  container.innerHTML = '';

  const filterTitle = document.querySelector('.filter-container:first-child label');
  if (filterTitle) {
    filterTitle.textContent = `–¢–µ–≥–∏ (–≤—ã–±—Ä–∞–Ω–æ: ${currentTags.length})`;
  }

  currentTags.forEach(tag => {
    const count = tagCounts[tag] || 0;

    const badge = document.createElement('div');
    badge.className = 'tag-badge';
    badge.innerHTML = `${tag} <span class="tag-count">${count}</span> <span class="remove-tag" onclick="removeTag('${tag}')">√ó</span>`;
    container.appendChild(badge);
  });
}

function removeTag(tagToRemove) {
  currentTags = currentTags.filter(tag => tag !== tagToRemove);

  const tagFilter = document.getElementById('tagFilter');
  Array.from(tagFilter.options).forEach(option => {
    if (option.value === tagToRemove) {
      option.selected = false;
    }
  });

  updateSelectedTagsDisplay();
  applyFilters();
}

function clearAllFilters() {
  currentTags = [];
  currentTheme = '';

  const tagFilter = document.getElementById('tagFilter');
  const themeFilter = document.getElementById('themeFilter');

  Array.from(tagFilter.options).forEach(option => {
    option.selected = false;
  });
  tagFilter.selectedIndex = 0;

  themeFilter.selectedIndex = 0;

  const filterTitle = document.querySelector('.filter-container:first-child label');
  if (filterTitle) {
    filterTitle.textContent = '–¢–µ–≥–∏';
  }

  updateSelectedTagsDisplay();
  applyFilters();
}

function applyFilters() {
  filteredData = allData.filter(item => {
    if (currentSearch) {
      const searchLower = currentSearch.toLowerCase();
      const inWord = item.word.toLowerCase().includes(searchLower);
      const inTranslation = item.translation.toLowerCase().includes(searchLower);
      const inExamples = item.examples.some(ex =>
        ex.en.toLowerCase().includes(searchLower) ||
        ex.ru.toLowerCase().includes(searchLower)
      );

      if (!inWord && !inTranslation && !inExamples) return false;
    }

    if (currentTags.length > 0) {
      if (!item.tags || !item.tags.length) return false;
      const hasAllTags = currentTags.every(tag => item.tags.includes(tag));
      if (!hasAllTags) return false;
    }

    if (currentTheme) {
      if (!item.theme || item.theme !== currentTheme) return false;
    }

    return true;
  });

  updateStats();
  renderPage(currentPage);
  buildPagination();
}

function initFilters() {
  const tagFilter = document.getElementById('tagFilter');
  const themeFilter = document.getElementById('themeFilter');

  tagFilter.addEventListener('change', function() {
    currentTags = Array.from(this.selectedOptions)
      .map(opt => opt.value)
      .filter(val => val !== "");

    updateSelectedTagsDisplay();
    applyFilters();
  });

  themeFilter.addEventListener('change', function() {
    currentTheme = this.value;
    applyFilters();
  });
}

function toggleIpaMode() {
  showIpa = !showIpa;
  document.body.classList.toggle("hide-ipa", !showIpa);

  const txt = showIpa
    ? "üôà –°–∫—Ä—ã—Ç—å IPA"
    : "üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å IPA";

  document.getElementById("ipaBtn").textContent = txt;
  document.getElementById("ipaBtnSide").textContent = txt;

  localStorage.setItem("show_ipa", showIpa);
}

function toggleSyllablesMode() {
  showSyllables = !showSyllables;
  document.body.classList.toggle("show-syllables", showSyllables);

  const txt = showSyllables
    ? "üî§ –°–∫—Ä—ã—Ç—å —Å–ª–æ–≥–∏"
    : "üî§ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≥–∏";

  document.getElementById("syllablesBtn").textContent = txt;
  document.getElementById("syllablesBtnSide").textContent = txt;

  localStorage.setItem("show_syllables", showSyllables);
  renderPage(currentPage);
}

function selectNode(el){
  const range = document.createRange();
  range.selectNodeContents(el);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

function selectSingleWordFromEvent(e, el){
  const text = el.textContent;
  const node = el.firstChild;
  if (!node || node.nodeType !== Node.TEXT_NODE) return text.trim();

  const pos = document.caretPositionFromPoint
    ? document.caretPositionFromPoint(e.clientX, e.clientY)
    : null;

  if (!pos || pos.offsetNode !== node) {
    return text.trim().split(/\s+/)[0];
  }

  const i = pos.offset;
  let L = i;
  while (L > 0 && /[\w'-]/.test(text[L-1])) L--;
  let R = i;
  while (R < text.length && /[\w'-]/.test(text[R])) R++;

  const range = document.createRange();
  range.setStart(node, L);
  range.setEnd(node, R);

  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);

  return text.slice(L, R).trim();
}

function highlightSearch(text, search) {
  if (!search) return text;

  const regex = new RegExp(search, 'gi');
  return text.replace(regex, match =>
    `<span style="background: rgba(251, 113, 133, 0.3); border-radius: 3px; padding: 0 2px;">${match}</span>`
  );
}

function jumpToCard() {
  const cardNumber = parseInt(document.getElementById('cardJumpInput').value);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞
  if (!cardNumber || cardNumber < 1 || cardNumber > 30000) {
    const errorMessage = document.createElement('div');
    errorMessage.style.cssText = `
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 100, 100, 0.9);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: fadeInOut 3s ease-in-out;
    `;

    errorMessage.textContent = '‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç 1 –¥–æ 30000';
    document.body.appendChild(errorMessage);

    setTimeout(() => {
      errorMessage.remove();
    }, 3000);

    return;
  }

  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º –µ—ë
  const pageNumber = Math.ceil(cardNumber / PAGE_SIZE);
  currentPage = pageNumber;
  renderPage(pageNumber);

  // –ü–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω—É–∂–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
  setTimeout(() => {
    const cardIndex = (cardNumber - 1) % PAGE_SIZE;
    const cards = document.querySelectorAll('.card');

    if (cards[cardIndex]) {
      // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ
      cards[cardIndex].scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });

      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
      cards[cardIndex].style.transition = 'all 0.3s ease';
      cards[cardIndex].style.boxShadow = '0 0 0 3px var(--accent)';
      cards[cardIndex].style.transform = 'scale(1.01)';

      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        cards[cardIndex].style.boxShadow = '';
        cards[cardIndex].style.transform = '';
      }, 2000);

      // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
      document.getElementById('cardJumpInput').focus();
    }
  }, 300);
}

function renderPage(page){
  currentPage = page;
  const container = document.getElementById("container");
  container.innerHTML = "";

  if (filteredData.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--muted);">üì≠ –ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
    updateStats();
    return;
  }

  const start = (page-1) * PAGE_SIZE;
  const slice = filteredData.slice(start, start + PAGE_SIZE);

  slice.forEach((item, i) => {
    const globalIndex = allData.findIndex(d => d.word === item.word) + 1;

    const encoded20 = encodeURIComponent(item.word);
    const encodedPlus = item.word.replace(/ /g, '+');
    const encodedUnder = item.word.replace(/ /g, '_');

    const youglish = `https://youglish.com/pronounce/${encodedUnder}/english`;
    const playphrase = `https://www.playphrase.me/#/search?q=${encodedPlus}&language=en`;
    const yandexTrans = `https://translate.yandex.ru/?source_lang=en&target_lang=ru&text=${encoded20}`;
    const transRu = `https://www.translate.ru/–∫–æ–Ω—Ç–µ–∫—Å—Ç—ã/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π-—Ä—É—Å—Å–∫–∏–π/${encoded20}`;
    const kartaslov = `https://en.kartaslov.ru/–ø–µ—Ä–µ–≤–æ–¥-–≤-–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ/${encodedPlus}`;
    const reverso = `https://context.reverso.net/–ø–µ—Ä–µ–≤–æ–¥/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π-—Ä—É—Å—Å–∫–∏–π/${encodedPlus}`;
    const wooordhunt = `https://wooordhunt.ru/word/${encoded20}`;
    const forvo = `https://ru.forvo.com/search/${encoded20}/`;
    const yandexImages = `https://yandex.ru/images/search?text=${encoded20}`;

    const card = document.createElement("div");
    card.className = "card";

    const examplesToShow = (currentTags.length === 0 && !currentTheme && !currentSearch)
      ? item.examples.slice(0, 4)
      : item.examples;

    const examplesHTML = examplesToShow.map(ex => {
      const ipaText = ex.ipa ? ex.ipa : '';
      const ipaHTML = ipaText ? `<div class="ipa">${ipaText}</div>` : '';

      const exampleSyllablesHTML = showSyllables && ex.syllables
        ? `
          <div class="example-syllables">
            ${ex.syllables.split('¬∑').map((syllable, i) => `
              <span class="syllable ${ex.stress && ex.stress.includes(i) ? 'stressed' : ''}">${syllable}</span>
            `).join('¬∑')}
          </div>
        `
        : '';

      const enText = currentSearch ? highlightSearch(ex.en, currentSearch) : ex.en;
      const ruText = currentSearch ? highlightSearch(ex.ru, currentSearch) : ex.ru;

      return `
        <div class="example">
          <div class="en" data-speak="${ex.en}">${enText}</div>
          ${exampleSyllablesHTML}
          ${ipaHTML}
          <div class="ru">${ruText}</div>
        </div>
      `;
    }).join("");

    const tagsHTML = item.tags && item.tags.length > 0 ? `
      <div class="word-tags">
        ${item.tags.map(tag => `
          <span class="word-tag" onclick="addTagFromCard('${tag.replace(/'/g, "\\'")}')">${tag}</span>
        `).join('')}
      </div>
    ` : '';

    const syllablesHTML = item.syllables && showSyllables
      ? `
        <div class="syllables">
          ${item.syllables.split('¬∑').map((syllable, i) => `
            <span class="syllable ${i === item.stress ? 'stressed' : ''}">${syllable}</span>
          `).join('¬∑')}
        </div>
      `
      : '';

    const ipaHTML = item.ipa ? `<div class="ipa">${item.ipa}</div>` : '';

    const wordEnHTML = currentSearch ? highlightSearch(item.word, currentSearch) : item.word;

    const cardIndexHTML = isMobileView
      ? `
        <div class="card-index">
          <div>
            <a href="${youglish}" target="_blank" title="YouGlish">
              <img src="img/youglish.png" alt="YouGlish" class="service-icon">
            </a>
            <a href="${playphrase}" target="_blank" title="PlayPhrase">
              <img src="img/playphrase.png" alt="PlayPhrase" class="service-icon">
            </a>
            <a href="${yandexTrans}" target="_blank" title="–Ø–Ω–¥–µ–∫—Å –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫">
              <img src="img/yandex.png" alt="–Ø–Ω–¥–µ–∫—Å –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫" class="service-icon">
            </a>
            <a href="${transRu}" target="_blank" title="Translate.ru">
              <img src="img/translateru.png" alt="Translate.ru" class="service-icon">
            </a>
            <a href="${kartaslov}" target="_blank" title="Kartaslov">
              <img src="img/kartaslov.png" alt="Kartaslov" class="service-icon">
            </a>
            <a href="${reverso}" target="_blank" title="Reverso Context">
              <img src="img/reverso.png" alt="Reverso" class="service-icon">
            </a>
            <a href="${wooordhunt}" target="_blank" title="WooordHunt">
              <img src="img/wooordhunt.png" alt="WooordHunt" class="service-icon">
            </a>
            <a href="${forvo}" target="_blank" title="Forvo">
              <img src="img/forvo.png" alt="Forvo" class="service-icon">
            </a>
            <a href="${yandexImages}" target="_blank" title="–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∏–Ω–∫–∏">
              <img src="img/yandex-images.png" alt="–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∏–Ω–∫–∏" class="service-icon">
            </a>
          </div>
          <span class="index-num">${globalIndex}</span>
        </div>
      `
      : `
        <div class="card-index">
          <a href="${youglish}" target="_blank" title="YouGlish - –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è –∏–∑ –≤–∏–¥–µ–æ">
            <img src="img/youglish.png" alt="YouGlish" class="service-icon">
          </a>
          <a href="${playphrase}" target="_blank" title="PlayPhrase - —Ñ—Ä–∞–∑—ã –∏–∑ —Ñ–∏–ª—å–º–æ–≤">
            <img src="img/playphrase.png" alt="PlayPhrase" class="service-icon">
          </a>
          <a href="${yandexTrans}" target="_blank" title="–Ø–Ω–¥–µ–∫—Å –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫">
            <img src="img/yandex.png" alt="–Ø–Ω–¥–µ–∫—Å –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫" class="service-icon">
          </a>
          <a href="${transRu}" target="_blank" title="Translate.ru">
            <img src="img/translateru.png" alt="Translate.ru" class="service-icon">
          </a>
          <a href="${kartaslov}" target="_blank" title="Kartaslov - –ø–µ—Ä–µ–≤–æ–¥ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ">
            <img src="img/kartaslov.png" alt="Kartaslov" class="service-icon">
          </a>
          <a href="${reverso}" target="_blank" title="Reverso Context">
            <img src="img/reverso.png" alt="Reverso" class="service-icon">
          </a>
          <a href="${wooordhunt}" target="_blank" title="WooordHunt">
            <img src="img/wooordhunt.png" alt="WooordHunt" class="service-icon">
          </a>
          <a href="${forvo}" target="_blank" title="Forvo - –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –æ—Ç –Ω–æ—Å–∏—Ç–µ–ª–µ–π">
            <img src="img/forvo.png" alt="Forvo" class="service-icon">
          </a>
          <a href="${yandexImages}" target="_blank" title="–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∏–Ω–∫–∏">
            <img src="img/yandex-images.png" alt="–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∏–Ω–∫–∏" class="service-icon">
          </a>
          <span class="index-num">${globalIndex}</span>
        </div>
      `;

    card.innerHTML = `
      ${cardIndexHTML}
      ${tagsHTML}
      <div class="word-line">
        <span class="word-en" data-speak="${item.word}">${wordEnHTML}</span>
        ${syllablesHTML}
        ${ipaHTML}
        <span class="word-ru">${item.translation}</span>
      </div>

      <div class="examples">
        ${examplesHTML}
      </div>
    `;
    container.appendChild(card);
  });

  document.querySelectorAll(".word-en, .en").forEach(el => {
    el.onclick = e => {
      selectNode(el);
      speakText(el.dataset.speak);
    };

    el.ondblclick = e => {
      e.preventDefault();
      e.stopPropagation();
      const w = selectSingleWordFromEvent(e, el);
      speakText(w);
    };
  });

  document.querySelectorAll(".word-ru, .ru")
    .forEach(el => el.onclick = () => selectNode(el));

  updateStats();
  updatePaginationUI();
}

function addTagFromCard(tag) {
  if (!currentTags.includes(tag)) {
    currentTags.push(tag);

    const tagFilter = document.getElementById('tagFilter');
    Array.from(tagFilter.options).forEach(option => {
      if (option.value === tag) {
        option.selected = true;
      }
    });

    updateSelectedTagsDisplay();
    applyFilters();
  }
}

function buildPagination() {
  const total = Math.ceil(filteredData.length / PAGE_SIZE);
  const pag = document.getElementById("pagination");
  pag.innerHTML = "";

  for (let i = 1; i <= total; i++) {
    const b = document.createElement("button");
    b.textContent = i;
    b.className = "page-btn";
    b.onclick = () => renderPage(i);
    pag.appendChild(b);
  }
}

function updatePaginationUI() {
  document.querySelectorAll(".page-btn")
    .forEach(btn => {
      btn.classList.toggle("active", btn.textContent == currentPage);
    });
}

let testMode = false;
function toggleTestMode() {
  testMode = !testMode;
  document.body.classList.toggle("hide-ru", testMode);
  const txt = testMode
    ? "üëÄ –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã"
    : "üß† –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞";
  document.getElementById("testBtn").textContent = txt;
  document.getElementById("testBtnSide").textContent = txt;
}

const saved = localStorage.getItem("theme");
if (saved) document.documentElement.setAttribute("data-theme", saved);

function toggleTheme() {
  const cur = document.documentElement.getAttribute("data-theme");
  const next = cur === "dark" ? "light" : "dark";
  document.documentElement.setAttribute("data-theme", next);
  localStorage.setItem("theme", next);
}

let isSettingsOpen = false;
function toggleSettings() {
  const panel = document.getElementById("sidePanel");
  if (isSettingsOpen) {
    panel.classList.remove("open");
    setTimeout(() => panel.style.display = "none", 300);
  } else {
    panel.style.display = "flex";
    setTimeout(() => panel.classList.add("open"), 10);
  }
  isSettingsOpen = !isSettingsOpen;
}

const rateSlider = document.getElementById("rateSlider");
const pitchSlider = document.getElementById("pitchSlider");
const rateLabel = document.getElementById("rateLabel");
const pitchLabel = document.getElementById("pitchLabel");

const rateSliderSide = document.getElementById("rateSliderSide");
const pitchSliderSide = document.getElementById("pitchSliderSide");
const rateLabelSide = document.getElementById("rateLabelSide");
const pitchLabelSide = document.getElementById("pitchLabelSide");

rateSlider.value = localStorage.getItem("tts_rate") || 0.9;
pitchSlider.value = localStorage.getItem("tts_pitch") || 1.02;
rateSliderSide.value = rateSlider.value;
pitchSliderSide.value = pitchSlider.value;

function updateLabels() {
  rateLabel.textContent = `x${parseFloat(rateSlider.value).toFixed(2)}`;
  pitchLabel.textContent = parseFloat(pitchSlider.value).toFixed(2);
  rateLabelSide.textContent = `x${parseFloat(rateSliderSide.value).toFixed(2)}`;
  pitchLabelSide.textContent = parseFloat(pitchSliderSide.value).toFixed(2);
}
updateLabels();

rateSlider.oninput = () => {
  rateSliderSide.value = rateSlider.value;
  localStorage.setItem("tts_rate", rateSlider.value);
  updateLabels();
};

pitchSlider.oninput = () => {
  pitchSliderSide.value = pitchSlider.value;
  localStorage.setItem("tts_pitch", pitchSlider.value);
  updateLabels();
};

rateSliderSide.oninput = () => {
  rateSlider.value = rateSliderSide.value;
  localStorage.setItem("tts_rate", rateSlider.value);
  updateLabels();
};

pitchSliderSide.oninput = () => {
  pitchSlider.value = pitchSliderSide.value;
  localStorage.setItem("tts_pitch", pitchSlider.value);
  updateLabels();
};

const voiceSelect = document.getElementById("voiceSelect");
const voiceSelectSide = document.getElementById("voiceSelectSide");
let VOICES = [];

const NAME_MAP = {
  "Ava": "Ava", "Nathan": "Nathan", "Alex": "–ê–ª–µ–∫—Å", "–ê–ª–µ–∫—Å": "–ê–ª–µ–∫—Å",
  "Zoe": "–ó–æ–∏", "–ó–æ–∏": "–ó–æ–∏", "Nikki": "–ù–∏–∫–∫–∏", "Nicky": "–ù–∏–∫–∫–∏",
  "–ù–∏–∫–∫–∏": "–ù–∏–∫–∫–∏", "Samantha": "–°–∞–º–∞–Ω—Ç–∞", "–°–∞–º–∞–Ω—Ç–∞": "–°–∞–º–∞–Ω—Ç–∞",
  "Susan": "–°—å—é–∑–µ–Ω", "–°—å—é–∑–µ–Ω": "–°—å—é–∑–µ–Ω", "Tom": "–¢–æ–º", "–¢–æ–º": "–¢–æ–º",
  "Evan": "–≠–≤–∞–Ω", "–≠–≤–∞–Ω": "–≠–≤–∞–Ω", "Alison": "–≠–ª–∏—Å–æ–Ω", "–≠–ª–∏—Å–æ–Ω": "–≠–ª–∏—Å–æ–Ω"
};

const GENDER_ICON = {
  "–¢–æ–º": "üë®", "–≠–≤–∞–Ω": "üë®", "Nathan": "üë®", "–ê–ª–µ–∫—Å": "üë®",
  "–ù–∏–∫–∫–∏": "üë©", "–°–∞–º–∞–Ω—Ç–∞": "üë©", "–ó–æ–∏": "üë©", "Ava": "üë©",
  "–°—å—é–∑–µ–Ω": "üë©", "–≠–ª–∏—Å–æ–Ω": "üë©"
};

const DISPLAY_ORDER = [
  "–¢–æ–º", "–≠–≤–∞–Ω", "Nathan", "–ê–ª–µ–∫—Å", "SEPARATOR",
  "–ù–∏–∫–∫–∏", "–°–∞–º–∞–Ω—Ç–∞", "–ó–æ–∏", "Ava", "–°—å—é–∑–µ–Ω", "–≠–ª–∏—Å–æ–Ω"
];

function populateDesktopVoices() {
  const allVoices = window.speechSynthesis.getVoices();
  if (!allVoices.length) return;

  const matched = allVoices.filter(v =>
    v.lang === "en-US" &&
    Object.keys(NAME_MAP).some(k => v.name.includes(k))
  );

  VOICES = matched;
  voiceSelect.innerHTML = "";
  voiceSelectSide.innerHTML = "";

  const items = VOICES.map((v, i) => {
    const short =
      Object.entries(NAME_MAP).find(([k]) => v.name.includes(k))?.[1] || v.name;
    const icon = GENDER_ICON[short] || "";
    return { index: i, label: icon ? `${icon} ${short}` : short, short };
  });

  DISPLAY_ORDER.forEach(name => {
    if (name === "SEPARATOR") {
      const s = document.createElement("option");
      s.textContent = "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ";
      s.disabled = true;
      voiceSelect.appendChild(s);
      voiceSelectSide.appendChild(s.cloneNode(true));
      return;
    }
    const f = items.find(it => it.short === name);
    if (f) {
      const o = document.createElement("option");
      o.value = f.index;
      o.textContent = f.label;
      voiceSelect.appendChild(o);
      voiceSelectSide.appendChild(o.cloneNode(true));
    }
  });

  const mute = document.createElement("option");
  mute.value = "mute";
  mute.textContent = "üîá –ë–µ–∑ –æ–∑–≤—É—á–∫–∏";
  voiceSelect.appendChild(mute);
  voiceSelectSide.appendChild(mute.cloneNode(true));

  const savedVoice = localStorage.getItem("tts_voice");
  const tom = VOICES.findIndex(v => v.name.includes("Tom"));
  const def = tom !== -1 ? tom : "mute";

  voiceSelect.value = savedVoice || def;
  voiceSelectSide.value = savedVoice || def;
}

function populateAndroidVoices() {
  voiceSelect.innerHTML = "";
  voiceSelectSide.innerHTML = "";

  const mute = document.createElement("option");
  mute.value = "mute";
  mute.textContent = "üîá –ë–µ–∑ –æ–∑–≤—É—á–∫–∏";
  voiceSelect.appendChild(mute);
  voiceSelectSide.appendChild(mute.cloneNode(true));

  const systemOption = document.createElement("option");
  systemOption.value = "system";
  systemOption.textContent = "üì± –°–∏—Å—Ç–µ–º–Ω—ã–π Google TTS (Android)";
  voiceSelect.appendChild(systemOption);
  voiceSelectSide.appendChild(systemOption.cloneNode(true));

  voiceSelect.value = "system";
  voiceSelectSide.value = "system";

  localStorage.setItem("tts_voice", "system");
}

function initVoices() {
  if (isAndroid) {
    populateAndroidVoices();
  } else {
    window.addEventListener("load", () => {
      const warmup = new SpeechSynthesisUtterance(" ");
      warmup.volume = 0;
      window.speechSynthesis.speak(warmup);
      setTimeout(populateDesktopVoices, 300);
      setTimeout(populateDesktopVoices, 800);
      setTimeout(populateDesktopVoices, 1500);
    });
    window.speechSynthesis.onvoiceschanged = populateDesktopVoices;
  }
}

voiceSelect.onchange = () => {
  voiceSelectSide.value = voiceSelect.value;
  localStorage.setItem("tts_voice", voiceSelect.value);
};
voiceSelectSide.onchange = () => {
  voiceSelect.value = voiceSelectSide.value;
  localStorage.setItem("tts_voice", voiceSelect.value);
};

function speakText(text) {
  if (voiceSelect.value === "mute") return;

  const synth = window.speechSynthesis;
  synth.cancel();

  if (isAndroid) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = parseFloat(rateSlider.value);
    u.pitch = parseFloat(pitchSlider.value);
    u.volume = 1.0;
    synth.speak(u);
  } else {
    const idx = parseInt(voiceSelect.value, 10);
    const voice = VOICES[idx] || VOICES[0];

    const u = new SpeechSynthesisUtterance(text);
    u.voice = voice;
    u.lang = "en-US";
    u.rate = parseFloat(rateSlider.value);
    u.pitch = parseFloat(pitchSlider.value);
    u.volume = 1.0;
    synth.speak(u);
  }
}

document.getElementById('searchInput').addEventListener('input', function(e) {
  currentSearch = e.target.value.trim();
  currentPage = 1;
  applyFilters();
});

fetch("data.json")
  .then(r => r.json())
  .then(data => {
    allData = data;
    filteredData = [...allData];

    detectPlatform();
    initVoices();

    extractTagsAndThemes();
    initFilters();

    const savedIpa = localStorage.getItem("show_ipa");
    if (savedIpa !== null) {
      showIpa = savedIpa === "true";
      document.body.classList.toggle("hide-ipa", !showIpa);

      const txt = showIpa
        ? "üôà –°–∫—Ä—ã—Ç—å IPA"
        : "üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å IPA";

      document.getElementById("ipaBtn").textContent = txt;
      document.getElementById("ipaBtnSide").textContent = txt;
    }

    const savedSyllables = localStorage.getItem("show_syllables");
    if (savedSyllables !== null) {
      showSyllables = savedSyllables === "true";
      document.body.classList.toggle("show-syllables", showSyllables);

      const txt = showSyllables
        ? "üî§ –°–∫—Ä—ã—Ç—å —Å–ª–æ–≥–∏"
        : "üî§ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≥–∏";

      document.getElementById("syllablesBtn").textContent = txt;
      document.getElementById("syllablesBtnSide").textContent = txt;
    }

    updateStats();
    renderPage(1);
    buildPagination();
  })
  .catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', err);
    document.getElementById('container').innerHTML =
      '<div style="text-align: center; padding: 40px; color: var(--muted);">‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ data.json</div>';
  });
</script>

</body>
</html>
