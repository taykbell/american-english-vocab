<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>üìñ Book Reader | American English</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root {
--bg: #fff1f6;
--text: #3b1f2b;
--muted: #8b6f7a;
--accent: #db2777;
--green: #9d174d;
--border: #f2d5e3;
--shadow: 0 4px 12px rgba(219,39,119,.08);
--sentence-bg: rgba(251, 113, 133, 0.03);
--header1: #2d1f2a;
--header2: #4a2a4a;
--header3: #6b3d6b;
--en-text: #db2777;
--syllables-text: #db2777;
--ipa-text: #db2777;
--explanation-text: #8b6f7a;
}
[data-theme="dark"] {
--bg: #160a10;
--text: #f8e6ee;
--muted: #c9a4b2;
--accent: #fb7185;
--green: #f472b6;
--border: #3b1423;
--shadow: 0 4px 12px rgba(0,0,0,.25);
--sentence-bg: rgba(251, 113, 133, 0.05);
--header1: #f8e6ee;
--header2: #e8d3e8;
--header3: #d9c2d9;
--en-text: #fb7185;
--syllables-text: #fb7185;
--ipa-text: #fb7185;
--explanation-text: #c9a4b2;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, system-ui, sans-serif;
margin: 0;
padding: 40px 20px 60px;
background: var(--bg);
color: var(--text);
transition: background .3s, color .3s;
line-height: 1.6;
}
/* ===== HEADER & SEARCH SECTION ===== */
.header-section {
max-width: 820px;
margin: 0 auto 30px;
text-align: center;
}
.header-title {
font-size: 2.2rem;
font-weight: 700;
margin: 0 0 8px;
color: var(--text);
}
.header-subtitle {
color: var(--muted);
font-size: 0.95rem;
margin-bottom: 20px;
}
.search-section {
display: flex;
flex-wrap: wrap;
justify-content: center;
align-items: center;
gap: 15px;
margin-bottom: 20px;
max-width: 720px;
margin-left: auto;
margin-right: auto;
}
.search-container {
flex: 1;
max-width: 400px;
min-width: 250px;
}
#searchInput {
width: 100%;
padding: 10px 15px;
border-radius: 10px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
font-size: 14px;
transition: all 0.3s;
}
#searchInput:focus {
outline: none;
border-color: var(--accent);
box-shadow: 0 0 0 3px rgba(219,39,119,0.1);
}
.stats {
font-size: 14px;
color: var(--muted);
padding: 6px 12px;
background: var(--bg);
border-radius: 8px;
border: 1px solid var(--border);
}
.book-selector {
display: flex;
justify-content: center;
align-items: center;
margin-bottom: 20px;
max-width: 720px;
margin-left: auto;
margin-right: auto;
}
.book-selector label {
margin-right: 10px;
font-size: 14px;
color: var(--muted);
}
#bookSelect {
padding: 10px 15px;
border-radius: 10px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
font-size: 14px;
width: 100%;
max-width: 400px;
}
/* ===== BOOK CONTAINER ===== */
#book-container {
max-width: 820px;
margin: 0 auto 40px;
text-align: left;
}
/* ===== HEADERS ===== */
.header1 {
font-size: 2.2rem;
font-weight: 700;
margin: 45px 0 25px;
color: var(--header1);
text-align: center;
letter-spacing: -0.5px;
position: relative;
}
.header1::after {
content: '';
display: block;
width: 80px;
height: 3px;
background: var(--accent);
margin: 12px auto 0;
border-radius: 3px;
}
.header2 {
font-size: 1.8rem;
font-weight: 600;
margin: 35px 0 22px;
color: var(--header2);
text-align: center;
position: relative;
}
.header2::after {
content: '';
display: block;
width: 60px;
height: 2px;
background: var(--accent);
margin: 10px auto 0;
border-radius: 2px;
}
.header3 {
font-size: 1.5rem;
font-weight: 500;
margin: 30px 0 18px;
color: var(--header3);
text-align: center;
}
/* ===== SENTENCE BLOCK ===== */
.sentence-block {
position: relative;
padding: 26px 32px 22px 22px;
margin-bottom: 36px;
transition: background-color 0.3s;
}
.sentence-block:hover {
background-color: var(--sentence-bg);
border-radius: 8px;
}
/* ===== NUMBERING ===== */
.sentence-index {
position: absolute;
top: 18px;
right: 18px;
font-size: 13px;
color: var(--text);
opacity: 0.12;
font-weight: 600;
user-select: none;
}
/* ===== SENTENCE LINES ===== */
.en-sentence {
font-size: 20px;
color: var(--en-text);
font-weight: 600;
cursor: pointer;
margin-bottom: 14px;
line-height: 1.5;
position: relative;
}
.syllables-line {
font-size: 19px;
color: var(--syllables-text);
font-weight: 600;
margin: 10px 0;
line-height: 1.4;
}
.syllable {
display: inline-block;
margin: 0 2px;
}
.syllable.stressed {
text-decoration: underline;
font-weight: 700;
}
.ipa-line {
font-family: "Lucida Sans Unicode", "Arial Unicode MS", sans-serif;
font-size: 18px;
color: var(--ipa-text);
font-style: italic;
opacity: 0.9;
margin: 10px 0;
line-height: 1.4;
padding-left: 6px;
border-left: 2px solid var(--ipa-text);
}
.explanation-line {
font-size: 17px;
color: var(--explanation-text);
margin-top: 12px;
line-height: 1.6;
font-style: italic;
}
/* ===== TOGGLED VISIBILITY ===== */
.hide-ipa .ipa-line {
display: none;
}
.hide-syllables .syllables-line {
display: none;
}
.hide-explanation .explanation-line {
display: none;
}
/* ===== HIGHLIGHT FOR PLAYBACK ===== */
.highlight-playing {
background-color: rgba(251, 113, 133, 0.12) !important;
position: relative;
border-radius: 6px;
transition: background-color 0.3s;
}
.highlight-playing::before {
content: "‚ñ∂";
position: absolute;
left: -22px;
top: 50%;
transform: translateY(-50%);
color: var(--accent);
font-size: 14px;
opacity: 0.8;
}
/* ===== CONTROLS ===== */
.settings-toggle, .theme-panel-toggle, .presets-panel-toggle {
position: fixed;
top: 18px;
right: 18px;
padding: 8px 12px;
border-radius: 10px;
border: 1px solid var(--border);
cursor: pointer;
background: var(--bg);
color: var(--text);
box-shadow: 0 2px 8px rgba(219,39,119,.12);
z-index: 100;
transition: all 0.2s;
}
.settings-toggle:hover, .theme-panel-toggle:hover, .presets-panel-toggle:hover {
transform: scale(1.05);
}
.settings-toggle {
top: 60px;
}
.theme-panel-toggle {
top: 102px;
}
.presets-panel-toggle {
top: 144px;
}
/* ===== SIDE PANEL ===== */
.side-panel {
position: fixed;
top: 102px;
right: 18px;
background: var(--bg);
border: 1px solid var(--border);
border-radius: 16px;
padding: 24px;
box-shadow: var(--shadow);
display: none;
z-index: 99;
width: 340px;
flex-direction: column;
gap: 20px;
opacity: 0;
transform: translateX(20px);
transition: opacity 0.3s ease, transform 0.3s ease;
}
.side-panel.open {
opacity: 1;
transform: translateX(0);
}
.side-panel > div {
width: 100%;
}
.side-panel label {
display: block;
margin-bottom: 10px;
font-size: 14px;
color: var(--muted);
font-weight: 500;
text-align: left;
}
.side-panel select, .side-panel input[type="range"] {
width: 100%;
padding: 10px 12px;
border-radius: 12px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
font-size: 14px;
}
.side-panel input[type="range"] {
accent-color: var(--accent);
height: 6px;
margin-top: 6px;
}
.slider-container {
display: flex;
align-items: center;
gap: 12px;
margin-top: 4px;
}
.slider-value {
min-width: 45px;
text-align: right;
font-weight: 500;
}
.toggle-buttons {
display: flex;
flex-direction: column;
gap: 12px;
}
.toggle-btn {
padding: 12px 16px;
border-radius: 12px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
cursor: pointer;
font-size: 15px;
font-weight: 500;
text-align: left;
transition: all 0.25s;
}
.toggle-btn:hover {
background: rgba(219, 39, 119, 0.08);
transform: translateX(2px);
}
.toggle-btn.active {
background: var(--accent);
color: white;
border-color: var(--accent);
}
.continuous-active {
background: var(--green) !important;
color: white !important;
border-color: var(--green) !important;
animation: pulse 1.5s infinite;
}
/* ===== –°–¢–ò–õ–ò –î–õ–Ø –ö–ù–û–ü–ö–ò DICTIONARY MODE ===== */
.dictionary-mode-btn {
padding: 12px 18px;
border-radius: 12px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
cursor: pointer;
font-size: 16px;
font-weight: 600;
transition: all 0.25s;
box-shadow: var(--shadow);
width: 100%;
text-align: center;
margin-top: 8px;
}
.dictionary-mode-btn:hover {
background: linear-gradient(135deg, var(--accent), var(--green));
color: white;
border-color: var(--accent);
transform: translateY(-2px);
box-shadow: 0 6px 16px rgba(219, 39, 119, 0.3);
}
/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
@keyframes pulse {
0% { box-shadow: 0 0 0 0 rgba(251, 113, 133, 0.7); }
70% { box-shadow: 0 0 0 8px rgba(251, 113, 133, 0); }
100% { box-shadow: 0 0 0 0 rgba(251, 113, 133, 0); }
}
/* ===== THEME PANEL ===== */
.theme-panel {
position: fixed;
top: 144px;
right: 18px;
background: var(--bg);
border: 1px solid var(--border);
border-radius: 16px;
padding: 24px;
box-shadow: var(--shadow);
display: none;
z-index: 98;
width: 340px;
flex-direction: column;
gap: 20px;
opacity: 0;
transform: translateX(20px);
transition: opacity 0.3s ease, transform 0.3s ease;
}
.theme-panel.open {
opacity: 1;
transform: translateX(0);
}
.theme-section {
border: 1px solid var(--border);
border-radius: 12px;
padding: 16px;
background: var(--bg);
margin-bottom: 15px;
}
.theme-section h3 {
font-size: 15px;
margin-bottom: 12px;
color: var(--accent);
font-weight: 600;
}
.color-picker-group {
display: flex;
flex-direction: column;
gap: 12px;
margin-bottom: 15px;
}
.color-picker-item {
display: flex;
align-items: center;
gap: 12px;
padding: 8px 10px;
border-radius: 8px;
background: rgba(219, 39, 119, 0.03);
transition: background 0.2s;
}
.color-picker-item:hover {
background: rgba(219, 39, 119, 0.08);
}
.color-label {
flex: 1;
font-size: 13px;
color: var(--text);
font-weight: 500;
}
.color-input {
width: 40px;
height: 40px;
border: none;
border-radius: 8px;
cursor: pointer;
background: transparent;
padding: 0;
}
.color-preview {
width: 24px;
height: 24px;
border-radius: 6px;
border: 2px solid var(--border);
display: inline-block;
}
.theme-presets {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 8px;
margin-bottom: 15px;
}
.preset-btn {
padding: 8px;
border-radius: 8px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
font-size: 11px;
cursor: pointer;
transition: all 0.2s;
text-align: center;
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
}
.preset-btn:hover {
background: var(--accent);
color: white;
border-color: var(--accent);
transform: translateY(-1px);
}
.preset-btn.active {
background: var(--accent);
color: white;
border-color: var(--accent);
}
.custom-presets {
display: flex;
flex-direction: column;
gap: 8px;
margin-bottom: 15px;
}
.custom-preset-item {
display: flex;
align-items: center;
gap: 8px;
padding: 8px;
border-radius: 8px;
background: rgba(219, 39, 119, 0.03);
border: 1px solid var(--border);
}
.custom-preset-name {
flex: 1;
font-size: 12px;
color: var(--text);
}
.custom-preset-colors {
display: flex;
gap: 3px;
}
.custom-preset-color {
width: 12px;
height: 12px;
border-radius: 3px;
border: 1px solid var(--border);
}
.custom-preset-actions {
display: flex;
gap: 4px;
}
.custom-preset-btn {
padding: 4px 8px;
border-radius: 4px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
font-size: 11px;
cursor: pointer;
transition: all 0.2s;
}
.custom-preset-btn:hover {
background: var(--accent);
color: white;
border-color: var(--accent);
}
.save-custom-preset {
display: flex;
gap: 8px;
margin-top: 10px;
}
.save-custom-preset input {
flex: 1;
padding: 8px 12px;
border-radius: 8px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
font-size: 13px;
}
.save-custom-preset button {
padding: 8px 12px;
border-radius: 8px;
border: 1px solid var(--border);
background: var(--accent);
color: white;
cursor: pointer;
font-size: 13px;
transition: all 0.2s;
}
.save-custom-preset button:hover {
background: var(--green);
transform: translateY(-1px);
}
.reset-theme-btn {
width: 100%;
padding: 10px;
border-radius: 10px;
border: 1px solid var(--border);
background: var(--bg);
color: var(--text);
font-size: 14px;
cursor: pointer;
transition: all 0.2s;
margin-top: 10px;
}
.reset-theme-btn:hover {
background: var(--accent);
color: white;
border-color: var(--accent);
}
/* ===== PRESETS PANEL ===== */
.presets-panel {
position: fixed;
top: 186px;
right: 18px;
background: var(--bg);
border: 1px solid var(--border);
border-radius: 16px;
padding: 24px;
box-shadow: var(--shadow);
display: none;
z-index: 97;
width: 340px;
flex-direction: column;
gap: 20px;
opacity: 0;
transform: translateX(20px);
transition: opacity 0.3s ease, transform 0.3s ease;
}
.presets-panel.open {
opacity: 1;
transform: translateX(0);
}
.presets-section {
border: 1px solid var(--border);
border-radius: 12px;
padding: 16px;
background: var(--bg);
margin-bottom: 15px;
}
.presets-section h3 {
font-size: 16px;
margin-bottom: 15px;
color: var(--accent);
font-weight: 600;
text-align: center;
padding-bottom: 8px;
border-bottom: 2px solid var(--border);
}
.presets-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 10px;
}
.preset-item {
padding: 10px;
border-radius: 8px;
border: 1px solid var(--border);
background: var(--bg);
cursor: pointer;
transition: all 0.2s;
text-align: center;
font-size: 10px;
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
}
.preset-item:hover {
background: var(--accent);
color: white;
border-color: var(--accent);
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(219,39,119,0.2);
}
.preset-item.active {
background: var(--accent);
color: white;
border-color: var(--accent);
box-shadow: 0 0 0 3px rgba(219,39,119,0.2);
}
/* ===== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ===== */
@media (max-width: 768px) {
body {
padding: 20px 15px 40px;
}
#book-container {
max-width: 100%;
padding: 0 5px;
}
.sentence-block {
padding: 20px 22px 18px 15px;
margin-bottom: 28px;
}
.en-sentence {
font-size: 19px;
}
.syllables-line, .ipa-line, .explanation-line {
font-size: 17px;
}
.sentence-index {
font-size: 12px;
top: 14px;
right: 12px;
}
.side-panel, .theme-panel, .presets-panel {
width: calc(100vw - 30px);
max-width: 380px;
top: 90px;
padding: 20px;
border-radius: 14px;
}
.settings-toggle, .theme-panel-toggle, .presets-panel-toggle {
top: 12px;
right: 12px;
padding: 7px 10px;
font-size: 13px;
}
.settings-toggle {
top: 52px;
}
.theme-panel-toggle {
top: 92px;
}
.presets-panel-toggle {
top: 132px;
}
.header-title {
font-size: 1.8rem;
}
.header-subtitle {
font-size: 0.85rem;
}
.header1 {
font-size: 1.8rem;
margin: 35px 0 20px;
}
.header2 {
font-size: 1.5rem;
margin: 30px 0 18px;
}
.header3 {
font-size: 1.3rem;
margin: 25px 0 15px;
}
.book-selector, .search-section {
flex-direction: column;
gap: 10px;
}
.book-selector label {
text-align: center;
width: 100%;
}
.theme-presets, .presets-grid {
grid-template-columns: repeat(3, 1fr);
}
/* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ö–ù–û–ü–ö–ê */
.dictionary-mode-btn {
padding: 10px 16px;
font-size: 15px;
}
}
@media (max-width: 480px) {
.sentence-block {
padding: 18px 18px 16px 12px;
margin-bottom: 24px;
}
.en-sentence {
font-size: 18px;
}
.syllables-line, .ipa-line, .explanation-line {
font-size: 16px;
}
.sentence-index {
font-size: 11px;
top: 12px;
right: 10px;
}
.side-panel, .theme-panel, .presets-panel {
padding: 16px;
}
.toggle-btn {
padding: 10px 14px;
font-size: 14px;
}
.header-title {
font-size: 1.5rem;
}
.header-subtitle {
font-size: 0.8rem;
}
.header1 {
font-size: 1.6rem;
margin: 30px 0 18px;
}
.header2 {
font-size: 1.3rem;
margin: 25px 0 15px;
}
.header3 {
font-size: 1.1rem;
margin: 20px 0 12px;
}
.theme-presets, .presets-grid {
grid-template-columns: repeat(2, 1fr);
}
/* –û–ß–ï–ù–¨ –ú–ê–õ–ï–ù–¨–ö–ê–Ø –ö–ù–û–ü–ö–ê */
.dictionary-mode-btn {
padding: 8px 14px;
font-size: 14px;
}
}
</style>
</head>
<body>
<button class="settings-toggle" id="settingsBtn">‚öôÔ∏è</button>
<button class="theme-panel-toggle" id="themePanelBtn">üé®</button>
<button class="presets-panel-toggle" id="presetsPanelBtn">‚ú®</button>
<!-- ===== HEADER & SEARCH SECTION ===== -->
<div class="header-section">
<h1 class="header-title">Book Reader with Breakdown</h1>
<p class="header-subtitle">–ß—Ç–µ–Ω–∏–µ –∫–Ω–∏–≥ —Å —Ä–∞–∑–±–æ—Ä–æ–º –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º</p>
<div class="search-section">
<div class="search-container">
<input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É...">
</div>
<div class="stats" id="totalStats">–í—Å–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: 0 (–Ω–∞–π–¥–µ–Ω–æ: 0)</div>
</div>
<div class="book-selector">
<label for="bookSelect">–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É:</label>
<select id="bookSelect">
<option value="books/book1.json">üìñ Book 1</option>
<option value="books/book2.json">üìñ Book 2</option>
<option value="books/book3.json">üìñ Book 3</option>
</select>
</div>
</div>
<div id="book-container"></div>
<!-- ===== SIDE PANEL ===== -->
<div class="side-panel" id="sidePanel">
<div>
<label>–ì–æ–ª–æ—Å:</label>
<select id="voiceSelect"></select>
</div>
<div>
<label>–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏:</label>
<div class="slider-container">
<input type="range" id="rateSlider" min="0.3" max="1.2" step="0.05" value="0.9">
<span class="slider-value" id="rateValue">x0.90</span>
</div>
</div>
<div>
<label>–í—ã—Å–æ—Ç–∞ –≥–æ–ª–æ—Å–∞:</label>
<div class="slider-container">
<input type="range" id="pitchSlider" min="0.7" max="1.3" step="0.05" value="1.02">
<span class="slider-value" id="pitchValue">1.02</span>
</div>
</div>
<div>
<label>–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏:</label>
<div class="slider-container">
<input type="range" id="delaySlider" min="2" max="10" step="0.5" value="3">
<span class="slider-value" id="delayValue">3.0s</span>
</div>
</div>
<div class="toggle-buttons">
<button class="toggle-btn" id="ipaToggle">üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å IPA</button>
<button class="toggle-btn" id="syllablesToggle">üî§ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≥–∏</button>
<button class="toggle-btn" id="explanationToggle">üí° –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è</button>
<button class="toggle-btn" id="continuousToggle">‚ñ∂Ô∏è –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</button>
</div>
<!-- ===== –ö–ù–û–ü–ö–ê DICTIONARY MODE (–≤ —Å–∞–º–æ–º –Ω–∏–∑—É –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏) ===== -->
<button class="dictionary-mode-btn" onclick="window.location.href='index.html'">
  üìö Dictionary Mode
</button>
</div>
<!-- ===== THEME PANEL ===== -->
<div class="theme-panel" id="themePanel">
<div class="theme-section">
<h3>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤</h3>
<div class="color-picker-group">
<div class="color-picker-item">
<span class="color-label">–§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã</span>
<input type="color" class="color-input" id="bgColorPicker" value="#fff1f6">
<span class="color-preview" style="background: #fff1f6;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç</span>
<input type="color" class="color-input" id="textColorPicker" value="#3b1f2b">
<span class="color-preview" style="background: #3b1f2b;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç</span>
<input type="color" class="color-input" id="enTextColorPicker" value="#db2777">
<span class="color-preview" style="background: #db2777;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–°–ª–æ–≥–∏</span>
<input type="color" class="color-input" id="syllablesColorPicker" value="#db2777">
<span class="color-preview" style="background: #db2777;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">IPA —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</span>
<input type="color" class="color-input" id="ipaColorPicker" value="#db2777">
<span class="color-preview" style="background: #db2777;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–û–±—ä—è—Å–Ω–µ–Ω–∏–µ</span>
<input type="color" class="color-input" id="explanationColorPicker" value="#8b6f7a">
<span class="color-preview" style="background: #8b6f7a;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–ó–∞–≥–æ–ª–æ–≤–∫–∏ 1</span>
<input type="color" class="color-input" id="header1ColorPicker" value="#2d1f2a">
<span class="color-preview" style="background: #2d1f2a;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–ó–∞–≥–æ–ª–æ–≤–∫–∏ 2</span>
<input type="color" class="color-input" id="header2ColorPicker" value="#4a2a4a">
<span class="color-preview" style="background: #4a2a4a;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–ó–∞–≥–æ–ª–æ–≤–∫–∏ 3</span>
<input type="color" class="color-input" id="header3ColorPicker" value="#6b3d6b">
<span class="color-preview" style="background: #6b3d6b;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç</span>
<input type="color" class="color-input" id="accentColorPicker" value="#db2777">
<span class="color-preview" style="background: #db2777;"></span>
</div>
<div class="color-picker-item">
<span class="color-label">–¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü</span>
<input type="color" class="color-input" id="borderColorPicker" value="#f2d5e3">
<span class="color-preview" style="background: #f2d5e3;"></span>
</div>
</div>
<div class="save-custom-preset">
<input type="text" id="customPresetName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞...">
<button id="saveCustomPresetBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
<div class="theme-section">
<h3>üíæ –ú–æ–∏ –ø—Ä–µ—Å–µ—Ç—ã</h3>
<div class="custom-presets" id="customPresetsList">
<!-- Custom presets will be loaded here -->
</div>
</div>
<button class="reset-theme-btn" id="resetThemeBtn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</div>
<!-- ===== PRESETS PANEL ===== -->
<div class="presets-panel" id="presetsPanel">
<div class="presets-section">
<h3>üåû –°–≤–µ—Ç–ª—ã–µ —Ç–µ–º—ã</h3>
<div class="presets-grid">
<div class="preset-item" data-preset="light-default">–†–æ–∑–æ–≤–∞—è</div>
<div class="preset-item" data-preset="light-blue">–°–∏–Ω—è—è</div>
<div class="preset-item" data-preset="light-green">–ó–µ–ª—ë–Ω–∞—è</div>
<div class="preset-item" data-preset="light-purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</div>
<div class="preset-item" data-preset="light-amber">–Ø–Ω—Ç–∞—Ä–Ω–∞—è</div>
<div class="preset-item" data-preset="light-gray">–°–µ—Ä–∞—è</div>
<div class="preset-item" data-preset="light-teal">–ë–∏—Ä—é–∑–æ–≤–∞—è</div>
<div class="preset-item" data-preset="light-pastel">–ü–∞—Å—Ç–µ–ª—å–Ω–∞—è</div>
<div class="preset-item" data-preset="light-warm">–¢—ë–ø–ª–∞—è</div>
<div class="preset-item" data-preset="light-cool">–•–æ–ª–æ–¥–Ω–∞—è</div>
<div class="preset-item" data-preset="light-terracotta">–¢–µ—Ä—Ä–∞–∫–æ—Ç–æ–≤–∞—è</div>
<div class="preset-item" data-preset="light-sunflower">–ü–æ–¥—Å–æ–ª–Ω—É—Ö</div>
<div class="preset-item" data-preset="light-lavender">–õ–∞–≤–∞–Ω–¥–∞</div>
<div class="preset-item" data-preset="light-mint">–ú—è—Ç–Ω–∞—è</div>
<div class="preset-item" data-preset="light-sand">–ü–µ—Å–æ—á–Ω–∞—è</div>
<div class="preset-item" data-preset="light-coral">–ö–æ—Ä–∞–ª–ª–æ–≤–∞—è</div>
</div>
</div>
<div class="presets-section">
<h3>üåô –¢—ë–º–Ω—ã–µ —Ç–µ–º—ã</h3>
<div class="presets-grid">
<div class="preset-item" data-preset="dark-default">–¢—ë–º–Ω–∞—è —Ä–æ–∑–æ–≤–∞—è</div>
<div class="preset-item" data-preset="dark-blue">–¢—ë–º–Ω–∞—è —Å–∏–Ω—è—è</div>
<div class="preset-item" data-preset="dark-green">–¢—ë–º–Ω–∞—è –∑–µ–ª—ë–Ω–∞—è</div>
<div class="preset-item" data-preset="dark-purple">–¢—ë–º–Ω–∞—è —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è</div>
<div class="preset-item" data-preset="dark-charcoal">–£–≥–æ–ª—å–Ω–∞—è</div>
<div class="preset-item" data-preset="dark-slate">–°–ª–∞–Ω—Ü–µ–≤–∞—è</div>
<div class="preset-item" data-preset="dark-midnight">–ü–æ–ª–Ω–æ—á—å</div>
<div class="preset-item" data-preset="dark-forest">–õ–µ—Å–Ω–∞—è</div>
<div class="preset-item" data-preset="dark-royal">–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è</div>
<div class="preset-item" data-preset="dark-crimson">–ë–∞–≥—Ä–æ–≤–∞—è</div>
<div class="preset-item" data-preset="dark-terracotta">–¢—ë–º–Ω–∞—è —Ç–µ—Ä—Ä–∞–∫–æ—Ç–æ–≤–∞—è</div>
<div class="preset-item" data-preset="dark-ocean">–û–∫–µ–∞–Ω</div>
<div class="preset-item" data-preset="dark-wine">–í–∏–Ω–Ω–∞—è</div>
<div class="preset-item" data-preset="dark-ember">–¢–ª–µ—é—â–∏–π —É–≥–æ–ª—å</div>
<div class="preset-item" data-preset="dark-space">–ö–æ—Å–º–æ—Å</div>
<div class="preset-item" data-preset="dark-gold">–ó–æ–ª–æ—Ç–∞—è</div>
</div>
</div>
</div>
<script>
// ===== DATA STRUCTURE =====
let bookData = [];
let filteredData = [];
let showIpa = true;
let showSyllables = true;
let showExplanation = true;
let continuousMode = false;
let continuousPlaying = false;
let currentSentenceIndex = 0;
let playbackTimeout = null;
let continuousDelay = 3.0;
let isAndroid = /android/i.test(navigator.userAgent);
let VOICES = [];
let currentSearch = '';
let currentTheme = 'light-default';
let customPresets = [];
// ===== THEME PRESETS =====
const THEME_PRESETS = {
// Light themes
'light-default': {
bg: '#fff1f6',
text: '#3b1f2b',
muted: '#8b6f7a',
accent: '#db2777',
green: '#9d174d',
border: '#f2d5e3',
enText: '#db2777',
syllablesText: '#db2777',
ipaText: '#db2777',
explanationText: '#8b6f7a',
header1: '#2d1f2a',
header2: '#4a2a4a',
header3: '#6b3d6b'
},
'light-blue': {
bg: '#f0f9ff',
text: '#1e3a8a',
muted: '#475569',
accent: '#0284c7',
green: '#0d9488',
border: '#bae6fd',
enText: '#0284c7',
syllablesText: '#0284c7',
ipaText: '#0284c7',
explanationText: '#475569',
header1: '#0c4a6e',
header2: '#1e40af',
header3: '#2563eb'
},
'light-green': {
bg: '#f0fdf4',
text: '#065f46',
muted: '#475569',
accent: '#16a34a',
green: '#059669',
border: '#bbf7d0',
enText: '#16a34a',
syllablesText: '#16a34a',
ipaText: '#16a34a',
explanationText: '#475569',
header1: '#047857',
header2: '#065f46',
header3: '#059669'
},
'light-purple': {
bg: '#faf5ff',
text: '#581c87',
muted: '#6b7280',
accent: '#9333ea',
green: '#7c3aed',
border: '#e9d5ff',
enText: '#9333ea',
syllablesText: '#9333ea',
ipaText: '#9333ea',
explanationText: '#6b7280',
header1: '#581c87',
header2: '#6d28d9',
header3: '#7e22ce'
},
'light-amber': {
bg: '#fef3c7',
text: '#854d0e',
muted: '#6b7280',
accent: '#b45309',
green: '#f59e0b',
border: '#fde68a',
enText: '#b45309',
syllablesText: '#b45309',
ipaText: '#b45309',
explanationText: '#6b7280',
header1: '#854d0e',
header2: '#a16207',
header3: '#f59e0b'
},
'light-gray': {
bg: '#f9fafb',
text: '#374151',
muted: '#6b7280',
accent: '#374151',
green: '#6b7280',
border: '#e5e7eb',
enText: '#374151',
syllablesText: '#374151',
ipaText: '#374151',
explanationText: '#6b7280',
header1: '#1f2937',
header2: '#374151',
header3: '#4b5563'
},
'light-teal': {
bg: '#f0fdfa',
text: '#0f766e',
muted: '#475569',
accent: '#0d9488',
green: '#14b8a6',
border: '#99f6e4',
enText: '#0d9488',
syllablesText: '#0d9488',
ipaText: '#0d9488',
explanationText: '#475569',
header1: '#0f766e',
header2: '#14b8a6',
header3: '#22d3ee'
},
'light-pastel': {
bg: '#fef9f9',
text: '#9d174d',
muted: '#8b6f7a',
accent: '#f472b6',
green: '#c026d3',
border: '#fde8ff',
enText: '#f472b6',
syllablesText: '#f472b6',
ipaText: '#f472b6',
explanationText: '#8b6f7a',
header1: '#9d174d',
header2: '#c026d3',
header3: '#e879f9'
},
'light-warm': {
bg: '#fffbeb',
text: '#854d0e',
muted: '#6b7280',
accent: '#b45309',
green: '#f59e0b',
border: '#fde68a',
enText: '#b45309',
syllablesText: '#b45309',
ipaText: '#b45309',
explanationText: '#6b7280',
header1: '#854d0e',
header2: '#a16207',
header3: '#f59e0b'
},
'light-cool': {
bg: '#f0f9ff',
text: '#1e3a8a',
muted: '#475569',
accent: '#1e40af',
green: '#2563eb',
border: '#bae6fd',
enText: '#1e40af',
syllablesText: '#1e40af',
ipaText: '#1e40af',
explanationText: '#475569',
header1: '#1e3a8a',
header2: '#2563eb',
header3: '#3b82f6'
},
'light-terracotta': {
bg: '#fdf6f0',
text: '#5c3d2e',
muted: '#8c6b5e',
accent: '#c76b4f',
green: '#b85c40',
border: '#e8d5cc',
enText: '#c76b4f',
syllablesText: '#c76b4f',
ipaText: '#c76b4f',
explanationText: '#8c6b5e',
header1: '#5c3d2e',
header2: '#8c5c4a',
header3: '#a86a54'
},
'light-sunflower': {
bg: '#fff9db',
text: '#5c4b1c',
muted: '#8c7a4a',
accent: '#e6b800',
green: '#d4a700',
border: '#f2e6b3',
enText: '#e6b800',
syllablesText: '#e6b800',
ipaText: '#e6b800',
explanationText: '#8c7a4a',
header1: '#5c4b1c',
header2: '#8c7a29',
header3: '#a8912e'
},
'light-lavender': {
bg: '#f9f7ff',
text: '#4a3d6b',
muted: '#7a6d9c',
accent: '#9d8bff',
green: '#8a74ff',
border: '#e6e0ff',
enText: '#9d8bff',
syllablesText: '#9d8bff',
ipaText: '#9d8bff',
explanationText: '#7a6d9c',
header1: '#4a3d6b',
header2: '#6b5d9c',
header3: '#7d6bc6'
},
'light-mint': {
bg: '#f0fff9',
text: '#1e5c4a',
muted: '#4a8c7a',
accent: '#34d399',
green: '#10b981',
border: '#bbf7d0',
enText: '#34d399',
syllablesText: '#34d399',
ipaText: '#34d399',
explanationText: '#4a8c7a',
header1: '#1e5c4a',
header2: '#2e8c6b',
header3: '#34d399'
},
'light-sand': {
bg: '#fef9f3',
text: '#6b5c4a',
muted: '#9c8d7a',
accent: '#d4b88c',
green: '#c4a87c',
border: '#e8e0d5',
enText: '#d4b88c',
syllablesText: '#d4b88c',
ipaText: '#d4b88c',
explanationText: '#9c8d7a',
header1: '#6b5c4a',
header2: '#9c8d6b',
header3: '#b8a87c'
},
'light-coral': {
bg: '#fff5f5',
text: '#8c3d3d',
muted: '#bc6d6d',
accent: '#ff6b6b',
green: '#ff5252',
border: '#ffd5d5',
enText: '#ff6b6b',
syllablesText: '#ff6b6b',
ipaText: '#ff6b6b',
explanationText: '#bc6d6d',
header1: '#8c3d3d',
header2: '#bc5c5c',
header3: '#ff6b6b'
},
// Dark themes
'dark-default': {
bg: '#160a10',
text: '#f8e6ee',
muted: '#c9a4b2',
accent: '#fb7185',
green: '#f472b6',
border: '#3b1423',
enText: '#fb7185',
syllablesText: '#fb7185',
ipaText: '#fb7185',
explanationText: '#c9a4b2',
header1: '#f8e6ee',
header2: '#e8d3e8',
header3: '#d9c2d9'
},
'dark-blue': {
bg: '#0f172a',
text: '#cbd5e1',
muted: '#94a3b8',
accent: '#60a5fa',
green: '#3b82f6',
border: '#1e293b',
enText: '#60a5fa',
syllablesText: '#60a5fa',
ipaText: '#60a5fa',
explanationText: '#94a3b8',
header1: '#cbd5e1',
header2: '#94a3b8',
header3: '#64748b'
},
'dark-green': {
bg: '#064e3b',
text: '#d1fae5',
muted: '#6ee7b7',
accent: '#34d399',
green: '#10b981',
border: '#042f2e',
enText: '#34d399',
syllablesText: '#34d399',
ipaText: '#34d399',
explanationText: '#6ee7b7',
header1: '#d1fae5',
header2: '#a7f3d0',
header3: '#6ee7b7'
},
'dark-purple': {
bg: '#2e1b4f',
text: '#e9d5ff',
muted: '#c4b5fd',
accent: '#a78bfa',
green: '#8b5cf6',
border: '#1f1726',
enText: '#a78bfa',
syllablesText: '#a78bfa',
ipaText: '#a78bfa',
explanationText: '#c4b5fd',
header1: '#e9d5ff',
header2: '#ddd6fe',
header3: '#c4b5fd'
},
'dark-charcoal': {
bg: '#0c0a09',
text: '#f5f5f5',
muted: '#a8a8a8',
accent: '#d4d4d4',
green: '#a3a3a3',
border: '#292524',
enText: '#d4d4d4',
syllablesText: '#d4d4d4',
ipaText: '#d4d4d4',
explanationText: '#a8a8a8',
header1: '#f5f5f5',
header2: '#d4d4d4',
header3: '#a3a3a3'
},
'dark-slate': {
bg: '#1c1917',
text: '#e7e5e4',
muted: '#a8a8a8',
accent: '#d6d3d1',
green: '#a8a8a8',
border: '#403d39',
enText: '#d6d3d1',
syllablesText: '#d6d3d1',
ipaText: '#d6d3d1',
explanationText: '#a8a8a8',
header1: '#f5f5f5',
header2: '#d4d4d4',
header3: '#a3a3a3'
},
'dark-midnight': {
bg: '#000000',
text: '#f0f0f0',
muted: '#a0a0a0',
accent: '#c0c0c0',
green: '#808080',
border: '#1f1f1f',
enText: '#c0c0c0',
syllablesText: '#c0c0c0',
ipaText: '#c0c0c0',
explanationText: '#a0a0a0',
header1: '#ffffff',
header2: '#e0e0e0',
header3: '#c0c0c0'
},
'dark-forest': {
bg: '#064e3b',
text: '#d1fae5',
muted: '#6ee7b7',
accent: '#10b981',
green: '#059669',
border: '#042f2e',
enText: '#10b981',
syllablesText: '#10b981',
ipaText: '#10b981',
explanationText: '#6ee7b7',
header1: '#d1fae5',
header2: '#a7f3d0',
header3: '#6ee7b7'
},
'dark-royal': {
bg: '#1e1b4b',
text: '#e0e7ff',
muted: '#9ca3af',
accent: '#818cf8',
green: '#6366f1',
border: '#312e81',
enText: '#818cf8',
syllablesText: '#818cf8',
ipaText: '#818cf8',
explanationText: '#9ca3af',
header1: '#e0e7ff',
header2: '#c7d2fe',
header3: '#a5b4fc'
},
'dark-crimson': {
bg: '#450a0a',
text: '#fed7aa',
muted: '#fca5a5',
accent: '#f87171',
green: '#ef4444',
border: '#7f1d1d',
enText: '#f87171',
syllablesText: '#f87171',
ipaText: '#f87171',
explanationText: '#fca5a5',
header1: '#fed7aa',
header2: '#fbbf24',
header3: '#f87171'
},
'dark-terracotta': {
bg: '#2c1e1a',
text: '#e6d5cb',
muted: '#c9a894',
accent: '#d87c5c',
green: '#c86b4b',
border: '#4a352e',
enText: '#d87c5c',
syllablesText: '#d87c5c',
ipaText: '#d87c5c',
explanationText: '#c9a894',
header1: '#e6d5cb',
header2: '#d9c2b2',
header3: '#c9a894'
},
'dark-ocean': {
bg: '#0a1a2c',
text: '#cbdbf9',
muted: '#8ca3d4',
accent: '#4a7bff',
green: '#3b6bff',
border: '#1a2a4a',
enText: '#4a7bff',
syllablesText: '#4a7bff',
ipaText: '#4a7bff',
explanationText: '#8ca3d4',
header1: '#cbdbf9',
header2: '#a3b4e6',
header3: '#7b8cd4'
},
'dark-wine': {
bg: '#2c0a1a',
text: '#f8d5e6',
muted: '#d494b4',
accent: '#c94a8c',
green: '#b83a7c',
border: '#4a1a2c',
enText: '#c94a8c',
syllablesText: '#c94a8c',
ipaText: '#c94a8c',
explanationText: '#d494b4',
header1: '#f8d5e6',
header2: '#e6b4d4',
header3: '#d494b4'
},
'dark-ember': {
bg: '#1a0a0a',
text: '#f8d5d5',
muted: '#c99494',
accent: '#ff6b6b',
green: '#ff5252',
border: '#4a1a1a',
enText: '#ff6b6b',
syllablesText: '#ff6b6b',
ipaText: '#ff6b6b',
explanationText: '#c99494',
header1: '#f8d5d5',
header2: '#e6b4b4',
header3: '#d49494'
},
'dark-space': {
bg: '#0a0a1a',
text: '#d5d5f8',
muted: '#9494c9',
accent: '#6b6bff',
green: '#5252ff',
border: '#1a1a4a',
enText: '#6b6bff',
syllablesText: '#6b6bff',
ipaText: '#6b6bff',
explanationText: '#9494c9',
header1: '#d5d5f8',
header2: '#b4b4e6',
header3: '#9494d4'
},
'dark-gold': {
bg: '#2c1c0a',
text: '#f8e6c3',
muted: '#d4b47a',
accent: '#ffc34a',
green: '#ffb83a',
border: '#4a3a1a',
enText: '#ffc34a',
syllablesText: '#ffc34a',
ipaText: '#ffc34a',
explanationText: '#d4b47a',
header1: '#f8e6c3',
header2: '#e6d4a3',
header3: '#d4c284'
}
};
// ===== INIT =====
document.addEventListener('DOMContentLoaded', async () => {
// Load visibility preferences
showIpa = localStorage.getItem('show_ipa') !== 'false';
showSyllables = localStorage.getItem('show_syllables') !== 'false';
showExplanation = localStorage.getItem('show_explanation') !== 'false';
continuousMode = localStorage.getItem('continuous_mode') === 'true';
continuousDelay = parseFloat(localStorage.getItem('continuous_delay') || '3.0');
// Load custom presets
loadCustomPresets();
// Load custom theme colors
loadCustomTheme();
updateToggleStates();
// Initialize voice controls
initVoices();
setupEventListeners();
// Initialize book selector
initBookSelector();
// Load default book
loadBookContent('books/book1.json');
});
// ===== THEME CUSTOMIZATION =====
function loadCustomPresets() {
const saved = localStorage.getItem('custom_theme_presets');
if (saved) {
customPresets = JSON.parse(saved);
renderCustomPresets();
}
}
function saveCustomPresets() {
localStorage.setItem('custom_theme_presets', JSON.stringify(customPresets));
renderCustomPresets();
}
function renderCustomPresets() {
const container = document.getElementById('customPresetsList');
container.innerHTML = '';
if (customPresets.length === 0) {
container.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--muted); font-size: 12px;">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤</div>';
return;
}
customPresets.forEach((preset, index) => {
const item = document.createElement('div');
item.className = 'custom-preset-item';
item.innerHTML = `
<span class="custom-preset-name">${preset.name}</span>
<div class="custom-preset-colors">
<span class="custom-preset-color" style="background: ${preset.colors.bg}"></span>
<span class="custom-preset-color" style="background: ${preset.colors.enText}"></span>
<span class="custom-preset-color" style="background: ${preset.colors.syllablesText}"></span>
<span class="custom-preset-color" style="background: ${preset.colors.ipaText}"></span>
</div>
<div class="custom-preset-actions">
<button class="custom-preset-btn apply-preset" data-index="${index}">‚Üí</button>
<button class="custom-preset-btn delete-preset" data-index="${index}">√ó</button>
</div>
`;
container.appendChild(item);
});
// Add event listeners
document.querySelectorAll('.apply-preset').forEach(btn => {
btn.addEventListener('click', (e) => {
const index = parseInt(e.target.dataset.index);
applyCustomPreset(index);
});
});
document.querySelectorAll('.delete-preset').forEach(btn => {
btn.addEventListener('click', (e) => {
const index = parseInt(e.target.dataset.index);
deleteCustomPreset(index);
});
});
}
function applyCustomPreset(index) {
const preset = customPresets[index];
applyColors(preset.colors);
updateColorPickers(preset.colors);
// Save to localStorage
localStorage.setItem('custom_theme_colors', JSON.stringify(preset.colors));
currentTheme = `custom-${index}`;
// Update active preset button
document.querySelectorAll('.preset-item').forEach(btn => {
btn.classList.remove('active');
});
}
function deleteCustomPreset(index) {
customPresets.splice(index, 1);
saveCustomPresets();
}
function saveCustomPreset() {
const name = document.getElementById('customPresetName').value.trim();
if (!name) {
alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞');
return;
}
const colors = {
bg: document.getElementById('bgColorPicker').value,
text: document.getElementById('textColorPicker').value,
muted: document.getElementById('explanationColorPicker').value,
accent: document.getElementById('accentColorPicker').value,
green: '#9d174d',
border: document.getElementById('borderColorPicker').value,
enText: document.getElementById('enTextColorPicker').value,
syllablesText: document.getElementById('syllablesColorPicker').value,
ipaText: document.getElementById('ipaColorPicker').value,
explanationText: document.getElementById('explanationColorPicker').value,
header1: document.getElementById('header1ColorPicker').value,
header2: document.getElementById('header2ColorPicker').value,
header3: document.getElementById('header3ColorPicker').value
};
customPresets.push({ name, colors });
saveCustomPresets();
document.getElementById('customPresetName').value = '';
}
function loadCustomTheme() {
const savedColors = JSON.parse(localStorage.getItem('custom_theme_colors')) || null;
if (savedColors) {
// Apply saved colors
applyColors(savedColors);
updateColorPickers(savedColors);
currentTheme = 'custom';
} else {
// Apply default preset
applyThemePreset('light-default');
}
}
function applyColors(colors) {
document.documentElement.style.setProperty('--bg', colors.bg);
document.documentElement.style.setProperty('--text', colors.text);
document.documentElement.style.setProperty('--muted', colors.muted);
document.documentElement.style.setProperty('--accent', colors.accent);
document.documentElement.style.setProperty('--green', colors.green);
document.documentElement.style.setProperty('--border', colors.border);
document.documentElement.style.setProperty('--en-text', colors.enText);
document.documentElement.style.setProperty('--syllables-text', colors.syllablesText);
document.documentElement.style.setProperty('--ipa-text', colors.ipaText);
document.documentElement.style.setProperty('--explanation-text', colors.explanationText);
document.documentElement.style.setProperty('--header1', colors.header1);
document.documentElement.style.setProperty('--header2', colors.header2);
document.documentElement.style.setProperty('--header3', colors.header3);
}
function updateColorPickers(colors) {
document.getElementById('bgColorPicker').value = colors.bg;
document.getElementById('textColorPicker').value = colors.text;
document.getElementById('accentColorPicker').value = colors.accent;
document.getElementById('borderColorPicker').value = colors.border;
document.getElementById('enTextColorPicker').value = colors.enText;
document.getElementById('syllablesColorPicker').value = colors.syllablesText;
document.getElementById('ipaColorPicker').value = colors.ipaText;
document.getElementById('explanationColorPicker').value = colors.explanationText;
document.getElementById('header1ColorPicker').value = colors.header1;
document.getElementById('header2ColorPicker').value = colors.header2;
document.getElementById('header3ColorPicker').value = colors.header3;
// Update previews
document.querySelectorAll('.color-preview').forEach(preview => {
const input = preview.previousElementSibling;
if (input && input.classList.contains('color-input')) {
preview.style.background = input.value;
}
});
}
function applyThemePreset(presetName) {
const preset = THEME_PRESETS[presetName];
if (!preset) return;
// Apply colors
applyColors(preset);
// Update color pickers
updateColorPickers(preset);
// Save to localStorage
localStorage.setItem('custom_theme_colors', JSON.stringify(preset));
currentTheme = presetName;
// Update active preset button
document.querySelectorAll('.preset-item').forEach(btn => {
btn.classList.toggle('active', btn.dataset.preset === presetName);
});
}
function saveCustomTheme() {
const colors = {
bg: document.getElementById('bgColorPicker').value,
text: document.getElementById('textColorPicker').value,
muted: document.getElementById('explanationColorPicker').value,
accent: document.getElementById('accentColorPicker').value,
green: '#9d174d',
border: document.getElementById('borderColorPicker').value,
enText: document.getElementById('enTextColorPicker').value,
syllablesText: document.getElementById('syllablesColorPicker').value,
ipaText: document.getElementById('ipaColorPicker').value,
explanationText: document.getElementById('explanationColorPicker').value,
header1: document.getElementById('header1ColorPicker').value,
header2: document.getElementById('header2ColorPicker').value,
header3: document.getElementById('header3ColorPicker').value
};
// Apply colors
applyColors(colors);
// Save to localStorage
localStorage.setItem('custom_theme_colors', JSON.stringify(colors));
currentTheme = 'custom';
// Remove active class from preset buttons
document.querySelectorAll('.preset-item').forEach(btn => {
btn.classList.remove('active');
});
}
function resetTheme() {
// Remove custom theme
localStorage.removeItem('custom_theme_colors');
// Apply default preset
applyThemePreset('light-default');
}
function initBookSelector() {
document.getElementById('bookSelect').addEventListener('change', function() {
loadBookContent(this.value);
});
}
async function loadBookContent(bookFile) {
try {
const response = await fetch(bookFile);
if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
bookData = await response.json();
filteredData = [...bookData];
updateStats();
renderBook();
// Save last book selection
localStorage.setItem('last_book', bookFile);
} catch (error) {
console.error('Error loading book:', error);
document.getElementById('book-container').innerHTML = `
<div style="text-align: center; padding: 60px 20px; color: var(--muted);">
<div style="font-size: 24px; margin-bottom: 16px;">üìö</div>
<div style="font-size: 18px; margin-bottom: 10px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥–∏</div>
<div style="opacity: 0.7;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ ${bookFile}</div>
</div>
`;
}
}
function updateStats() {
// Count only paragraph sentences (not headers)
const total = bookData.reduce((sum, item) =>
item.type === 'paragraph' && item.content ? sum + item.content.length : sum, 0
);
const filtered = filteredData.reduce((sum, item) =>
item.type === 'paragraph' && item.content ? sum + item.content.length : sum, 0
);
document.getElementById('totalStats').textContent =
`–í—Å–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: ${total} (–Ω–∞–π–¥–µ–Ω–æ: ${filtered})`;
}
function setupEventListeners() {
// Settings panel toggle
document.getElementById('settingsBtn').addEventListener('click', toggleSettingsPanel);
// Theme panel toggle
document.getElementById('themePanelBtn').addEventListener('click', toggleThemePanel);
// Presets panel toggle
document.getElementById('presetsPanelBtn').addEventListener('click', togglePresetsPanel);
// Theme customization
const colorPickers = [
'bgColorPicker', 'textColorPicker', 'enTextColorPicker', 'syllablesColorPicker',
'ipaColorPicker', 'explanationColorPicker', 'header1ColorPicker', 'header2ColorPicker',
'header3ColorPicker', 'accentColorPicker', 'borderColorPicker'
];
colorPickers.forEach(pickerId => {
document.getElementById(pickerId).addEventListener('input', (e) => {
saveCustomTheme();
// Update preview
const preview = e.target.nextElementSibling;
if (preview && preview.classList.contains('color-preview')) {
preview.style.background = e.target.value;
}
});
});
// Theme presets
document.querySelectorAll('.preset-item').forEach(btn => {
btn.addEventListener('click', () => {
applyThemePreset(btn.dataset.preset);
});
});
// Save custom preset
document.getElementById('saveCustomPresetBtn').addEventListener('click', saveCustomPreset);
// Reset theme
document.getElementById('resetThemeBtn').addEventListener('click', resetTheme);
// Toggle buttons
document.getElementById('ipaToggle').addEventListener('click', () => {
showIpa = !showIpa;
localStorage.setItem('show_ipa', showIpa);
updateToggleStates();
renderBook();
});
document.getElementById('syllablesToggle').addEventListener('click', () => {
showSyllables = !showSyllables;
localStorage.setItem('show_syllables', showSyllables);
updateToggleStates();
renderBook();
});
document.getElementById('explanationToggle').addEventListener('click', () => {
showExplanation = !showExplanation;
localStorage.setItem('show_explanation', showExplanation);
updateToggleStates();
renderBook();
});
document.getElementById('continuousToggle').addEventListener('click', toggleContinuousMode);
// Sliders
document.getElementById('rateSlider').addEventListener('input', updateRate);
document.getElementById('pitchSlider').addEventListener('input', updatePitch);
document.getElementById('delaySlider').addEventListener('input', updateDelay);
// Voice selection
document.getElementById('voiceSelect').addEventListener('change', saveVoicePreference);
// Search input
document.getElementById('searchInput').addEventListener('input', handleSearch);
// Close panels when clicking outside
document.addEventListener('click', (e) => {
const sidePanel = document.getElementById('sidePanel');
const themePanel = document.getElementById('themePanel');
const presetsPanel = document.getElementById('presetsPanel');
const settingsBtn = document.getElementById('settingsBtn');
const themePanelBtn = document.getElementById('themePanelBtn');
const presetsPanelBtn = document.getElementById('presetsPanelBtn');
// Close side panel
if (sidePanel.classList.contains('open') &&
!sidePanel.contains(e.target) &&
!settingsBtn.contains(e.target)) {
toggleSettingsPanel();
}
// Close theme panel
if (themePanel.classList.contains('open') &&
!themePanel.contains(e.target) &&
!themePanelBtn.contains(e.target)) {
toggleThemePanel();
}
// Close presets panel
if (presetsPanel.classList.contains('open') &&
!presetsPanel.contains(e.target) &&
!presetsPanelBtn.contains(e.target)) {
togglePresetsPanel();
}
});
}
function togglePresetsPanel() {
const panel = document.getElementById('presetsPanel');
const isSettingsOpen = document.getElementById('sidePanel').classList.contains('open');
const isThemeOpen = document.getElementById('themePanel').classList.contains('open');
if (panel.style.display === 'none' || panel.style.display === '') {
// Close other panels if open
if (isSettingsOpen) {
document.getElementById('sidePanel').classList.remove('open');
setTimeout(() => {
document.getElementById('sidePanel').style.display = 'none';
}, 300);
}
if (isThemeOpen) {
document.getElementById('themePanel').classList.remove('open');
setTimeout(() => {
document.getElementById('themePanel').style.display = 'none';
}, 300);
}
panel.style.display = 'flex';
setTimeout(() => panel.classList.add('open'), 10);
} else {
panel.classList.remove('open');
setTimeout(() => panel.style.display = 'none', 300);
}
}
function toggleThemePanel() {
const panel = document.getElementById('themePanel');
const isSettingsOpen = document.getElementById('sidePanel').classList.contains('open');
const isPresetsOpen = document.getElementById('presetsPanel').classList.contains('open');
if (panel.style.display === 'none' || panel.style.display === '') {
// Close other panels if open
if (isSettingsOpen) {
document.getElementById('sidePanel').classList.remove('open');
setTimeout(() => {
document.getElementById('sidePanel').style.display = 'none';
}, 300);
}
if (isPresetsOpen) {
document.getElementById('presetsPanel').classList.remove('open');
setTimeout(() => {
document.getElementById('presetsPanel').style.display = 'none';
}, 300);
}
panel.style.display = 'flex';
setTimeout(() => panel.classList.add('open'), 10);
} else {
panel.classList.remove('open');
setTimeout(() => panel.style.display = 'none', 300);
}
}
function toggleSettingsPanel() {
const panel = document.getElementById('sidePanel');
const isThemeOpen = document.getElementById('themePanel').classList.contains('open');
const isPresetsOpen = document.getElementById('presetsPanel').classList.contains('open');
if (panel.style.display === 'none' || panel.style.display === '') {
// Close other panels if open
if (isThemeOpen) {
document.getElementById('themePanel').classList.remove('open');
setTimeout(() => {
document.getElementById('themePanel').style.display = 'none';
}, 300);
}
if (isPresetsOpen) {
document.getElementById('presetsPanel').classList.remove('open');
setTimeout(() => {
document.getElementById('presetsPanel').style.display = 'none';
}, 300);
}
panel.style.display = 'flex';
setTimeout(() => panel.classList.add('open'), 10);
} else {
panel.classList.remove('open');
setTimeout(() => panel.style.display = 'none', 300);
}
}
function handleSearch(e) {
currentSearch = e.target.value.trim().toLowerCase();
filterBookContent();
}
function filterBookContent() {
if (!currentSearch) {
filteredData = [...bookData];
renderBook();
updateStats();
return;
}
// Collect matching headers
const headerMatches = bookData.filter(item =>
item.type === 'header' &&
item.text.toLowerCase().includes(currentSearch)
);
// Collect matching paragraphs (with at least one matching sentence)
const paragraphMatches = bookData.filter(item => {
if (item.type !== 'paragraph' || !item.content) return false;
return item.content.some(sentence =>
sentence.en.toLowerCase().includes(currentSearch) ||
(sentence.explanation && sentence.explanation.toLowerCase().includes(currentSearch))
);
});
// Combine matches while preserving original order
filteredData = [...headerMatches, ...paragraphMatches];
renderBook();
updateStats();
}
// ===== AUTOPLAYBACK FUNCTIONS =====
function toggleContinuousMode() {
if (continuousPlaying) {
stopContinuousPlayback();
continuousMode = false;
} else {
continuousMode = !continuousMode;
if (continuousMode) {
startContinuousPlayback();
}
}
updateToggleStates();
localStorage.setItem('continuous_mode', continuousMode);
}
function startContinuousPlayback() {
stopContinuousPlayback();
continuousPlaying = true;
currentSentenceIndex = 0;
playCurrentSentence();
}
function stopContinuousPlayback() {
continuousPlaying = false;
if (playbackTimeout) {
clearTimeout(playbackTimeout);
playbackTimeout = null;
}
window.speechSynthesis.cancel();
// Remove all highlights
document.querySelectorAll('.en-sentence.highlight-playing').forEach(el => {
el.classList.remove('highlight-playing');
});
}
function playCurrentSentence() {
if (!continuousPlaying) return;
// Get all English sentences
const allSentences = document.querySelectorAll('.en-sentence');
if (currentSentenceIndex >= allSentences.length) {
stopContinuousPlayback();
return;
}
// Remove previous highlights
document.querySelectorAll('.en-sentence.highlight-playing').forEach(el => {
el.classList.remove('highlight-playing');
});
// Highlight current sentence
const currentSentence = allSentences[currentSentenceIndex];
currentSentence.classList.add('highlight-playing');
// Scroll to sentence
currentSentence.scrollIntoView({
behavior: 'smooth',
block: 'center'
});
// Speak the sentence
speakText(currentSentence.textContent, () => {
if (continuousPlaying) {
currentSentenceIndex++;
playbackTimeout = setTimeout(playCurrentSentence, continuousDelay * 1000);
}
});
}
function handleSentenceClick(el, e) {
e.stopPropagation();
if (continuousMode) {
if (el.classList.contains('highlight-playing')) {
stopContinuousPlayback();
continuousPlaying = false;
updateToggleStates();
} else {
stopContinuousPlayback();
const allSentences = Array.from(document.querySelectorAll('.en-sentence'));
const startIndex = allSentences.indexOf(el);
if (startIndex !== -1) {
continuousPlaying = true;
currentSentenceIndex = startIndex;
updateToggleStates();
playCurrentSentence();
}
}
} else {
speakText(el.textContent);
}
}
function handleSentenceDoubleClick(el, e) {
e.stopPropagation();
stopContinuousPlayback();
const word = selectSingleWordFromEvent(e, el);
speakText(word);
}
function updateRate(e) {
const value = parseFloat(e.target.value).toFixed(2);
document.getElementById('rateValue').textContent = `x${value}`;
localStorage.setItem('tts_rate', value);
}
function updatePitch(e) {
const value = parseFloat(e.target.value).toFixed(2);
document.getElementById('pitchValue').textContent = value;
localStorage.setItem('tts_pitch', value);
}
function updateDelay(e) {
continuousDelay = parseFloat(e.target.value);
document.getElementById('delayValue').textContent = `${continuousDelay.toFixed(1)}s`;
localStorage.setItem('continuous_delay', continuousDelay);
}
// ===== VOICE MANAGEMENT =====
function initVoices() {
const rateSlider = document.getElementById('rateSlider');
const pitchSlider = document.getElementById('pitchSlider');
const delaySlider = document.getElementById('delaySlider');
// Load saved preferences
const savedRate = localStorage.getItem('tts_rate') || '0.9';
const savedPitch = localStorage.getItem('tts_pitch') || '1.02';
const savedDelay = localStorage.getItem('continuous_delay') || '3.0';
rateSlider.value = savedRate;
pitchSlider.value = savedPitch;
delaySlider.value = savedDelay;
document.getElementById('rateValue').textContent = `x${parseFloat(savedRate).toFixed(2)}`;
document.getElementById('pitchValue').textContent = parseFloat(savedPitch).toFixed(2);
document.getElementById('delayValue').textContent = `${parseFloat(savedDelay).toFixed(1)}s`;
if (isAndroid) {
populateAndroidVoices();
} else {
// Warm up speech synthesis
const warmup = new SpeechSynthesisUtterance(" ");
warmup.volume = 0;
window.speechSynthesis.speak(warmup);
// Populate voices after delay
setTimeout(populateDesktopVoices, 300);
setTimeout(populateDesktopVoices, 800);
setTimeout(populateDesktopVoices, 1500);
}
window.speechSynthesis.onvoiceschanged = populateDesktopVoices;
}
const NAME_MAP = {
"Ava": "Ava", "Nathan": "Nathan", "Alex": "–ê–ª–µ–∫—Å", "–ê–ª–µ–∫—Å": "–ê–ª–µ–∫—Å",
"Zoe": "–ó–æ–∏", "–ó–æ–∏": "–ó–æ–∏", "Nikki": "–ù–∏–∫–∫–∏", "Nicky": "–ù–∏–∫–∫–∏",
"–ù–∏–∫–∫–∏": "–ù–∏–∫–∫–∏", "Samantha": "–°–∞–º–∞–Ω—Ç–∞", "–°–∞–º–∞–Ω—Ç–∞": "–°–∞–º–∞–Ω—Ç–∞",
"Susan": "–°—å—é–∑–µ–Ω", "–°—å—é–∑–µ–Ω": "–°—å—é–∑–µ–Ω", "Tom": "–¢–æ–º", "–¢–æ–º": "–¢–æ–º",
"Evan": "–≠–≤–∞–Ω", "–≠–≤–∞–Ω": "–≠–≤–∞–Ω", "Alison": "–≠–ª–∏—Å–æ–Ω", "–≠–ª–∏—Å–æ–Ω": "–≠–ª–∏—Å–æ–Ω"
};
const GENDER_ICON = {
"–¢–æ–º": "üë®", "–≠–≤–∞–Ω": "üë®", "Nathan": "üë®", "–ê–ª–µ–∫—Å": "üë®",
"–ù–∏–∫–∫–∏": "üë©", "–°–∞–º–∞–Ω—Ç–∞": "üë©", "–ó–æ–∏": "üë©", "Ava": "üë©",
"–°—å—é–∑–µ–Ω": "üë©", "–≠–ª–∏—Å–æ–Ω": "üë©"
};
const DISPLAY_ORDER = [
"–¢–æ–º", "–≠–≤–∞–Ω", "Nathan", "–ê–ª–µ–∫—Å", "SEPARATOR",
"–ù–∏–∫–∫–∏", "–°–∞–º–∞–Ω—Ç–∞", "–ó–æ–∏", "Ava", "–°—å—é–∑–µ–Ω", "–≠–ª–∏—Å–æ–Ω"
];
function populateDesktopVoices() {
const allVoices = window.speechSynthesis.getVoices();
if (!allVoices.length) return;
const matched = allVoices.filter(v =>
v.lang === "en-US" &&
Object.keys(NAME_MAP).some(k => v.name.includes(k))
);
VOICES = matched;
const voiceSelect = document.getElementById('voiceSelect');
voiceSelect.innerHTML = "";
const items = VOICES.map((v, i) => {
const short =
Object.entries(NAME_MAP).find(([k]) => v.name.includes(k))?.[1] || v.name;
const icon = GENDER_ICON[short] || "";
return { index: i, label: icon ? `${icon} ${short}` : short, short };
});
DISPLAY_ORDER.forEach(name => {
if (name === "SEPARATOR") {
const s = document.createElement("option");
s.textContent = "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ";
s.disabled = true;
voiceSelect.appendChild(s);
return;
}
const f = items.find(it => it.short === name);
if (f) {
const o = document.createElement("option");
o.value = f.index;
o.textContent = f.label;
voiceSelect.appendChild(o);
}
});
const mute = document.createElement("option");
mute.value = "mute";
mute.textContent = "üîá –ë–µ–∑ –æ–∑–≤—É—á–∫–∏";
voiceSelect.appendChild(mute);
const savedVoice = localStorage.getItem("tts_voice");
const tom = VOICES.findIndex(v => v.name.includes("Tom"));
const def = tom !== -1 ? tom : "mute";
voiceSelect.value = savedVoice || def;
}
function populateAndroidVoices() {
const voiceSelect = document.getElementById("voiceSelect");
voiceSelect.innerHTML = "";
const mute = document.createElement("option");
mute.value = "mute";
mute.textContent = "üîá –ë–µ–∑ –æ–∑–≤—É—á–∫–∏";
voiceSelect.appendChild(mute);
const systemOption = document.createElement("option");
systemOption.value = "system";
systemOption.textContent = "üì± –°–∏—Å—Ç–µ–º–Ω—ã–π Google TTS (Android)";
voiceSelect.appendChild(systemOption);
voiceSelect.value = "system";
localStorage.setItem("tts_voice", "system");
}
function saveVoicePreference(e) {
localStorage.setItem("tts_voice", e.target.value);
}
// ===== SPEECH =====
function speakText(text, onEndCallback) {
const voiceValue = document.getElementById('voiceSelect').value;
if (voiceValue === "mute") {
if (onEndCallback) onEndCallback();
return;
}
window.speechSynthesis.cancel();
const utterance = new SpeechSynthesisUtterance(text);
utterance.lang = 'en-US';
utterance.rate = parseFloat(document.getElementById('rateSlider').value);
utterance.pitch = parseFloat(document.getElementById('pitchSlider').value);
utterance.volume = 1.0;
if (onEndCallback) {
utterance.onend = onEndCallback;
}
if (!isAndroid) {
const idx = parseInt(voiceValue, 10);
const voice = VOICES[idx] || VOICES[0];
utterance.voice = voice;
}
window.speechSynthesis.speak(utterance);
}
// ===== TEXT SELECTION =====
function selectNode(el) {
const range = document.createRange();
range.selectNodeContents(el);
const sel = window.getSelection();
sel.removeAllRanges();
sel.addRange(range);
}
function selectSingleWordFromEvent(e, el) {
const text = el.textContent;
const node = el.firstChild;
if (!node || node.nodeType !== Node.TEXT_NODE) return text.trim();
const pos = document.caretPositionFromPoint
? document.caretPositionFromPoint(e.clientX, e.clientY)
: null;
if (!pos || pos.offsetNode !== node) {
return text.trim().split(/\s+/)[0];
}
const i = pos.offset;
let L = i;
while (L > 0 && /[\w'-]/.test(text[L-1])) L--;
let R = i;
while (R < text.length && /[\w'-]/.test(text[R])) R++;
const range = document.createRange();
range.setStart(node, L);
range.setEnd(node, R);
const sel = window.getSelection();
sel.removeAllRanges();
sel.addRange(range);
return text.slice(L, R).trim();
}
// ===== RENDERING =====
function renderBook() {
const container = document.getElementById('book-container');
container.innerHTML = '';
if (filteredData.length === 0) {
container.innerHTML = `
<div style="text-align: center; padding: 60px 20px; color: var(--muted);">
<div style="font-size: 24px; margin-bottom: 16px;">üîç</div>
<div style="font-size: 18px; margin-bottom: 10px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
<div style="opacity: 0.7;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–Ω–∏–≥—É</div>
</div>
`;
return;
}
let sentenceCounter = 0;
filteredData.forEach((item, index) => {
if (item.type === 'header') {
// Render header with appropriate styling
const header = document.createElement('div');
header.className = `header${item.level}`;
header.textContent = item.text;
container.appendChild(header);
}
else if (item.type === 'paragraph' && item.content && item.content.length > 0) {
// Render paragraph with sentences
item.content.forEach((sentence, i) => {
sentenceCounter++;
const block = document.createElement('div');
block.className = 'sentence-block';
block.innerHTML = `<div class="sentence-index">${sentenceCounter}</div>`;
const enSentence = document.createElement('div');
enSentence.className = 'en-sentence';
enSentence.textContent = sentence.en;
block.appendChild(enSentence);
if (showSyllables && sentence.syllables) {
const syllablesDiv = document.createElement('div');
syllablesDiv.className = 'syllables-line';
const syllParts = sentence.syllables.split('¬∑');
const cleanedEn = sentence.en.replace(/[^\w\s'-]/g, ' ');
const enWords = cleanedEn.split(/\s+/).filter(word => word.length > 0);
let htmlParts = [];
let globalIdx = 0;
for (let word of enWords) {
let wordSylls = [];
let wordLength = word.length;
while (wordLength > 0 && globalIdx < syllParts.length) {
let syll = syllParts[globalIdx];
wordSylls.push(`<span class="syllable ${sentence.stress?.includes(globalIdx) ? 'stressed' : ''}">${syll}</span>`);
wordLength -= syll.length;
globalIdx++;
}
if (wordSylls.length > 0) {
htmlParts.push(wordSylls.join('¬∑'));
}
}
syllablesDiv.innerHTML = htmlParts.join(' ');
block.appendChild(syllablesDiv);
}
if (showIpa && sentence.ipa) {
const ipaDiv = document.createElement('div');
ipaDiv.className = 'ipa-line';
ipaDiv.textContent = sentence.ipa;
block.appendChild(ipaDiv);
}
if (showExplanation && sentence.explanation) {
const explanationDiv = document.createElement('div');
explanationDiv.className = 'explanation-line';
explanationDiv.textContent = sentence.explanation;
block.appendChild(explanationDiv);
}
container.appendChild(block);
});
}
});
// Add event listeners to sentences
document.querySelectorAll('.en-sentence').forEach(el => {
el.addEventListener('click', (e) => handleSentenceClick(el, e));
el.addEventListener('dblclick', (e) => handleSentenceDoubleClick(el, e));
el.title = continuousMode ?
"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞. –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –æ–∑–≤—É—á–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞." :
"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –æ–∑–≤—É—á–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –æ–∑–≤—É—á–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞.";
});
}
function updateToggleStates() {
document.body.classList.toggle('hide-ipa', !showIpa);
document.body.classList.toggle('hide-syllables', !showSyllables);
document.body.classList.toggle('hide-explanation', !showExplanation);
document.getElementById('ipaToggle').classList.toggle('active', showIpa);
document.getElementById('syllablesToggle').classList.toggle('active', showSyllables);
document.getElementById('explanationToggle').classList.toggle('active', showExplanation);
const continuousBtn = document.getElementById('continuousToggle');
continuousBtn.classList.toggle('active', continuousMode);
continuousBtn.classList.toggle('continuous-active', continuousPlaying);
if (continuousPlaying) {
continuousBtn.textContent = '‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ';
} else {
continuousBtn.textContent = continuousMode ? '‚ñ∂Ô∏è –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (–≤–∫–ª)' : '‚ñ∂Ô∏è –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ';
}
}
// ===== CLEANUP ON UNLOAD =====
window.addEventListener('beforeunload', () => {
stopContinuousPlayback();
});
</script>
</body>
</html>